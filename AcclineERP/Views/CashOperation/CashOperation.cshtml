@model App.Domain.CashOperation
@{
    ViewBag.Title = "Cash Operation";
    Layout = "~/Views/Shared/_Layout.cshtml";

    List<App.Domain.ViewModel.CashOperationVModel> items = (List<App.Domain.ViewModel.CashOperationVModel>)ViewBag.Items;
    var cashReceiptWithdraw = items.Where(x => x.Tag == "CR" || x.Tag == "BW").ToList();
    var expenseDeposit = items.Where(x => x.Tag == "CP" || x.Tag == "BD").ToList();
    double recTotal = cashReceiptWithdraw.Sum(x => x.Amount);
    double expTotal = expenseDeposit.Sum(x => x.Amount);
    double closeBal = Convert.ToDouble(ViewData["OpenBal"]) + recTotal - expTotal;
}
<link href="~/App_Themes/Theme1/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
<link href="~/App_Themes/Theme1/plugins/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
<link href="~/App_Themes/Theme1/plugins/datatables/jquery.dataTables.min.css" rel="stylesheet" type="text/css" />
<link href="~/App_Themes/Theme1/plugins/select2/select2.css" rel="stylesheet" type="text/css" />
<link href="~/Css/FormDesign.css" rel="stylesheet" />

<style>
    table.dataTable.select tbody tr,
    table.dataTable thead th:first-child {
        cursor: pointer;
    }

    .form-control {
        border: 1px solid #00ffff;
    }

    .required:after {
        content: " *";
        font-weight: bold;
        color: red;
    }

    .largeSpace {
        margin-right: 13px;
        margin-left: 9px;
    }

    a#glgoR {
        color: darkblue;
    }

    a#GLEntries {
        color: darkblue;
    }

    a#glgo {
        color: darkblue;
    }

    a#GLEntriesp {
        color: darkblue;
    }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    input[type=number] {
        -moz-appearance: textfield;
    }
</style>

@using (Html.BeginForm("CashOperation", "CashOperation", FormMethod.Post, new { @id = "formSubmit" }))
{
    <div class="column">
        <div class="col-md-12">
            <div class="panel panel-color panel-primary">                
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <text style="text-align:left !important; text-decoration: none">Cash Operation</text>
                        <text id="@Html.IdFor(x => x.BranchCode)" style="text-align:right !important; text-decoration: none; font-weight:bold; color:antiquewhite; font-size:medium; margin-left:500px">Branch: @ViewBag.branchCode</text>
                    </h3>
                </div>
                <div class="panel-body" style="height:110px">
                    <div class="col-md-12" style="margin-left:400px">
                        <div class="col-md-6" style="text-align:end">
                            @Html.LabelFor(x => x.TrDate, new { @class = "col-md-4 control-label" })
                            <div class="input-group form-group col-md-6">
                                <input type="text" class="form-control datePage" name="TrDate" id="@Html.IdFor(x => x.TrDate)" value="@ViewBag.Date">
                                <span class="input-group-addon bg-primary b-0 text-white"></span>
                                <span class="input-group-addon bg-primary b-0 text-white" id="search">GO</span>
                            </div>
                            @Html.ValidationMessageFor(x => x.TrDate)
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-left:400px">
                        <div class="col-md-6" style="text-align:end">
                            @Html.LabelFor(x => x.OpenBal, new { @class = "col-md-4 control-label" })
                            <div class="input-group form-group col-md-6">
                                <input type="text" class="form-control" id="@Html.IdFor(x => x.OpenBal)"  value="@ViewBag.OpenBal" disabled="disabled">
                            </div>
                            @Html.ValidationMessageFor(x => x.OpenBal)
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="column">
        <div class="col-md-12">
            <div class="panel panel-color panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Receive</h3>
                </div>
                <div class="panel-body">
                    <div class="col-md-12">
                        <div class="col-md-4 control-label">

                            <label class="control-label" target="_blank">
                                @Html.ActionLink(
                                "Receipt Voucher waiting for Posting",
                                "GetJournalVoucher",
                                "CashOperation",
                                new { Date = "blankDate" },
                                new { id = "glgoR", }
                                )
                            </label>
                            <label id="CountNo">(@ViewBag.GLProvition)</label>
                        </div>
                        <div class="col-md-3 control-label">
                            <label class="control-label" target="_blank">
                                @Html.ActionLink(
                                "List Of Receipt Voucher",
                                "GetGLEntries",
                                "CashOperation",
                                new { Date = "blankDate" },
                                new { id = "GLEntries", }
                                )
                            </label>
                            <label>(@ViewBag.GLEntries)</label>
                        </div>



                        <div class="col-md-5">
                            <button id="addModalButton" value="Add" class="btn" style="width:110px">Cash Receipt</button> &ensp; &ensp;
                            <button id="addModalButton1" value="Add1" class="btn" style="width:180px">Bank Withdraw </button>
                        </div>
                    </div>

                    <div class="row col-md-10" style="margin-left:80px">
                        <div class="row">
                            <div class="col-md-11">
                                <br />
                                <br />
                                <table class="table table-bordered table-responsive" id="datatable-buttons">
                                    <thead>
                                        <tr>
                                            <th>SL</th>
                                            <th>Transaction No</th>
                                            <th>Voucher No</th>
                                            <th>Purpose</th>
                                            <th>Amount</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyId">
                                        @foreach (var item in cashReceiptWithdraw)
                                        {
                                            <tr>
                                                <td>@item.SerialNo</td>
                                                <td>@item.TransactionNo</td>

                                                <td>@item.VoucherNo</td>

                                                <td>@item.Purpose</td>
                                                <td>@item.Amount</td>

                                                <td>
                                                    <a href="#" class="on-default remove-row deleteSup largeSpace" data-id="1" id="delete" value="@item.TransactionNo" tag="@item.Tag"><i class="glyphicon glyphicon-trash"></i></a>

                                                    <a href="#" class="on-default remove-row deleteSup" data-id="1" id="edit" value="@item.TransactionNo" tag="@item.Tag"><i class="glyphicon glyphicon-edit"></i></a>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-left:250px; margin-top:10px">
                        <div class="col-md-6">
                            @Html.LabelFor(x => x.RecTotal, new { @class = "col-md-2 control-label" })
                            <div class="form-group col-md-8">
                                <div class="input-group form-group col-md-9">
                                    <input type="text" class="form-control" id="@Html.IdFor(x => x.RecTotal)"  value="@recTotal" disabled="disabled"> 
                                </div>
                                @Html.ValidationMessageFor(x => x.RecTotal)
                            </div>
                        </div>
                        <div class="col-md-6"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="column">
        <div class="col-md-12">
            <div class="panel panel-color panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title">Payment</h3>
                </div>
                <div class="panel-body">
                    <div class="col-md-12">
                        <div class="col-md-4 control-label">

                            <label class="control-label" target="_blank">
                                @Html.ActionLink(
                                "Payment Voucher waiting for Posting",
                                "GetJournalVoucher",
                                "CashOperation",
                                new { Date = "blankDate" },
                                new { id = "glgo", }
                                )
                            </label>
                            <label id="lblProvB">(@ViewBag.GLProvitionB)</label>

                        </div>

                        <div class="col-md-3 control-label">

                            <label class="control-label" target="_blank">
                                @Html.ActionLink(
                                "List Of Payment Voucher",
                                "GetGLEntries",
                                "CashOperation",
                                new { Date = "blankDate" },
                                new { id = "GLEntriesp", }
                                )
                            </label>
                            <label id="lblEntries">(@ViewBag.GLEntriesB)</label>

                        </div>
                                             

                        <div class="col-md-5">
                            <button id="addModalButton2" value="Add2" class="btn" style="width:120px">Cash Payment</button> &ensp; &ensp;
                            <button id="addModalButton3" value="Add3" class="btn" style="width:150px">Bank Deposit</button>
                        </div>

                    </div>
                    <div class="row col-md-10" style="margin-left:80px">
                        <div class="row">
                            <div class="col-md-11">
                                <br />
                                <br />
                                <table class="table table-bordered table-responsive" id="datatable-buttons1">
                                    <thead>
                                        <tr>
                                            <th>SL</th>
                                            <th>Transaction No</th>
                                            <th>Voucher No</th>
                                            <th>Purpose</th>
                                            <th>Amount</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tbodyId1">
                                        @foreach (var item in expenseDeposit)
                                        {
                                            <tr>
                                                <td>@item.SerialNo</td>
                                                <td>@item.TransactionNo</td>
                                                <td>@item.VoucherNo</td>
                                                <td>@item.Purpose</td>
                                                <td>@item.Amount</td>

                                                <td>
                                                    <a href="#" class="on-default remove-row deleteSup largeSpace" data-id="1" id="delete" value="@item.TransactionNo" tag="@item.Tag"><i class="glyphicon glyphicon-trash"></i></a>

                                                    <a href="#" class="on-default remove-row deleteSup" data-id="1" id="edit" value="@item.TransactionNo" tag="@item.Tag"><i class="glyphicon glyphicon-edit"></i></a>
                                                </td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-12" style="margin-left:200px; margin-top:10px">
                        <div class="col-md-6">
                            @Html.LabelFor(x => x.PayTotal, new { @class = "col-md-4 control-label" })
                            <div class="form-group col-md-8">
                                <div class="input-group form-group col-md-9">
                                    <input type="text" class="form-control" id="@Html.IdFor(x => x.PayTotal)"  value="@expTotal" disabled="disabled">  @**@
                                </div>
                                @Html.ValidationMessageFor(x => x.PayTotal)
                            </div>
                        </div>
                        <div class="col-md-6"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="column">
        <div class="col-md-12">
            <div class="panel panel-color panel-primary">
                <div class="panel-body">
                    <div class="col-md-12" style="margin-left:400px">
                        <div class="col-md-6" style="text-align:end">
                            @Html.LabelFor(x => x.CloseBal, new { @class = "col-md-4 control-label" })
                            <div class="form-group col-md-8">
                                <div class="input-group form-group col-md-10">
                                    <input type="text" class="form-control" id="@Html.IdFor(x => x.CloseBal)"  value="@closeBal" disabled="disabled">    @**@
                                </div>
                                @Html.ValidationMessageFor(x => x.CloseBal)
                            </div>
                        </div>
                    </div>

                    <div class="col-md-12" style="margin-left:400px">
                        <div class="col-md-6" style="text-align:end">
                            @Html.LabelFor(x => x.ClosedBy, new { @class = "col-md-4" })
                            <div class="form-group col-md-8">
                                <div class="input-group form-group col-md-10">
                                    <input type="text" class="form-control" id="@Html.IdFor(x => x.ClosedBy)"  value="@ViewBag.ClosedBy" disabled="disabled">
                                </div>
                                @Html.ValidationMessageFor(x => x.ClosedBy)
                            </div>
                        </div>
                        <div class="col-md-6"></div>
                    </div>
                   
                        <div class="row col-md-12" style="text-align:end">
                            <div class="col-md-4"></div>
                            <div class="col-md-8" style=" text-align:right;overflow:hidden;">
                                <input type="button" value="Cash Closed" class="btn btn-primary" id="cashClose" style="width:130px; text-align:center" />
                                <input type="button" value="Print" class="btn btn-primary" id="print" style="width:100px;" />
                            </div>
                        </div>
                                      
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Cash Receipt</h3>

                            </div>
                            <div class="panel-body">
                                @*<div class="col-md-6" style="margin-left:480px; font-size:13px; font-weight:bold">
                                        <button id="addModalButton4" value="Add" class="btn" style="width:110px">Issue</button>
                                    </div>*@
                                <div class="col-md-12">

                                    <label class="col-md-3" for="ReceiptNo">Receipt No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="ReceiptNo" name="ReceiptNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="ReceiptNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-3" for="ReceiptDate">Receipt Date</label>
                                    <div class="form-group col-md-6">
                                        <input type="text" class="form-control datePage" id="ReceiptDate" value="@ViewBag.Date" disabled="disabled">
                                        <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="VoucherNo">Voucher No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="VoucherNo" name="VoucherNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="VoucherNo" data-valmsg-replace="true"></span>

                                    </div>
                                    @*<a href="" title="Website name"><i style="width: 10px; height:10px; color: #08acfb;" class="fa-plus-circle"></i></a>*@
                                    @*<span class="bg-primary b-0 text-white" style="width: 130px; margin-top: 100px;" id="newVchr"><i class="md-sync"></i></span>*@

                                </div>
                                @if (ViewBag.MaintJob == true)
                                {
                                    <div class="col-md-12">
                                        <label class="col-md-3">Job No</label>
                                        <div class="col-md-8" style="padding-left:0px">
                                            <div class="col-md-8" style="padding-left:0px">
                                                <div class="col-md-12 input-group form-group" style="padding-left: 5px !important;">
                                                    <select class="form-control select2" id="JobNo" name="JobNo">
                                                        <option value=" ">---- Select ----</option>
                                                        @foreach (var item in ViewBag.JobNo)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="col-md-12">
                                                    <input type="button" class="btn" value="Add Job" id="btnJob" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="purAccode">Purpose</label>
                                    <div class="form-group col-md-6">
                                        <select class="form-control select2"  id="purAccode" name="purAccode">
                                            <option>Select Purpose</option>
                                            @foreach (var item in ViewBag.purAccode)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                    <span class="input-group-addon bg-primary b-0 text-white" id="crSubsidiary"><i class="ion-android-add"></i></span>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="RefNo">Ref No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="RefNo" name="RefNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="RefNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="Amount">Amount</label>
                                    <div class="form-group col-md-4">
                                        <input class="form-control" id="Amount" name="Amount" type="number" placeholder="0" >
                                        <span class="field-validation-valid" data-valmsg-for="Amount" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <input type="checkbox" class="Advance" id="Advance" name="Advance" value="" style="height:15px; width:15px"> &ensp;&nbsp;&nbsp; <label>Advance</label>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-3" for="Remarks">Remarks</label>
                                    <div class="form-group col-md-9">
                                        <input class="form-control" id="Remarks" name="Remarks" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="Remarks" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-4"></label>
                                        <input type="button" value="Print" class="btn btn-primary" id="btnPreview" onclick="location.href='@Url.Action("GetMoneyReceiptPdf", "CashReceipt")?ReceiptNo=' + $('#ReceiptNo').val()" />
                                        <input type="button" value="Save" class="btn btn-primary" id="saveCashReceipt" />
                                        <input type="button" value="Save" class="btn btn-primary" id="saveCRWithIssue" />
                                        <input type="button" value="Save" class="btn btn-primary" id="saveCRWithSub" />
                                        <input type="button" value="Update" class="btn btn-primary" id="UpdateCashReceipt" />
                                        <input type="button" value="Update" class="btn btn-primary" id="UpdateCRWithSub" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearCashReceipt" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeCashReceipt" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Withdraw From Bank</h3>

                            </div>
                            <div class="panel-body">

                                <div class="col-md-12">

                                    <label class="col-md-3" for="withdrawNo">Withdraw No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="withdrawNo" name="withdrawNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="withdrawNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="withdrawDate">Withdraw Date</label>
                                    <div class="form-group col-md-6">
                                        <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="withdrawDate" value="@ViewBag.Date" disabled="disabled">
                                        <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="wVoucherNo">Voucher No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="wVoucherNo" name="wVoucherNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="wVoucherNo" data-valmsg-replace="true"></span>
                                    </div>
                                    @*<span class="bg-primary b-0 text-white" style="width: 130px; margin-top: 100px;" id="newVchr"><i class="md-sync"></i></span>*@
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="WAccode">Bank A/C</label>
                                    <div class="form-group col-md-6">
                                        <select class="form-control select2"  id="WAccode" name="WAccode">
                                            <option>Select Bank A/C</option>
                                            @foreach (var item in ViewBag.BAccode)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="wChequeNo">Cheque No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="wChequeNo"  name="wChequeNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="wChequeNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="wAmount">Amount</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="wAmount"  name="wAmount" type="number" placeholder="0">
                                        <span class="field-validation-valid" data-valmsg-for="wAmount" data-valmsg-replace="true"></span>
                                    </div>
                                </div>


                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-6"></label>
                                        <input type="button" value="Save" class="btn btn-primary" id="saveWithdraw" />
                                        <input type="button" value="Update" class="btn btn-primary" id="UpdateWithdraw" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearWithdraw" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeWithdraw" />

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal2" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Payment</h3>

                            </div>
                            <div style="margin-top:10px">
                                <div class="col-md-12">
                                    <label class="col-md-3" for="ExpenseNo">Payment No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="ExpenseNo" name="ExpenseNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="ExpenseNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-3" for="ExpenseDate">Payment Date</label>
                                    <div class="form-group col-md-6">
                                        <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="ExpenseDate" value="@ViewBag.Date" disabled="disabled">
                                        <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="eVoucherNo">Voucher No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="eVoucherNo" name="eVoucherNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="eVoucherNo" data-valmsg-replace="true"></span>
                                    </div>
                                    @*<span class="bg-primary b-0 text-white" style="width: 130px; margin-top: 100px;" id="newVchr"><i class="md-sync"></i></span>*@
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="PayRefNo">Ref No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="PayRefNo" name="PayRefNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="PayRefNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="EAccode">Purpose</label>
                                    <div class="form-group col-md-6">
                                        <select class="form-control select2"  id="EAccode" name="EAccode">
                                            <option>Select Purpose</option>
                                            @foreach (var item in ViewBag.EAccode)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                    <span class="input-group-addon bg-primary b-0 text-white" id="exSubsidiary"><i class="ion-android-add"></i></span>
                                </div>
                                @if (ViewBag.MaintJob == true)
                                {
                                    <div class="col-md-12">
                                        <label class="col-md-3">Job No</label>
                                        <div class="col-md-8" style="padding-left:0px">
                                            <div class="col-md-8" style="padding-left:0px">
                                                <div class="col-md-12 input-group form-group" style="padding-left: 5px !important;">
                                                    <select class="form-control select2" id="expJobNo" name="expJobNo">
                                                        <option value=" ">---- Select ----</option>
                                                        @foreach (var item in ViewBag.JobNo)
                                                        {
                                                            <option value="@item.Value">@item.Text</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="col-md-12">
                                                    <input type="button" class="btn" value="Add Job" id="btnJob" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="EAmount">Amount</label>
                                    <div class="form-group col-md-4">
                                        <input class="form-control" id="EAmount" name="EAmount" type="number" placeholder="0" >
                                        <span class="field-validation-valid" data-valmsg-for="EAmount" data-valmsg-replace="true"></span>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <input type="checkbox" class="EAdvance" id="EAdvance" name="EAdvance" value="" style="height:15px; width:15px"> &ensp;&nbsp;&nbsp; <label>Advance</label>
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <label class="col-md-3" for="Remarks1">Remarks</label>
                                    <div class="form-group col-md-9">
                                        <input class="form-control" id="Remarks1" name="Remarks" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="Remarks1" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-6"></label>
                                        <input type="button" value="Save" class="btn btn-primary" id="saveExpense" />
                                        <input type="button" value="Save" class="btn btn-primary" id="saveExWithReceive" />
                                        <input type="button" value="Save" class="btn btn-primary" id="saveExWithSub" />
                                        <input type="button" value="Update" class="btn btn-primary" id="updateExpense" />
                                        <input type="button" value="Update" class="btn btn-primary" id="UpdateExWithSub" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearExpense" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeExpense" />

                                    </div>
                                </div>

                                @***********For RECEIVE*********************@
                                <div id="pnlReceive" class="row col-md-12">
                                    <div class="row col-md-12" style="margin-top:10px;">
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4">Receive No</label>
                                            <div class="input-group form-group col-md-8" style="padding-left:1px;">
                                                <input type="text" class="form-control" id="RcvNo" name="RcvNo" value="" />

                                            </div>
                                        </div>
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4">Voucher No</label>
                                            <div class="input-group form-group col-md-8" style="padding-left:1px;">
                                                <input class="form-control" id="VchrNo" name="VchrNo" type="text" value="">
                                                <span class="field-validation-valid" data-valmsg-for="VchrNo" data-valmsg-replace="true"></span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row col-md-12">
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4">Item Type</label>
                                            <div class="input-group form-group col-md-8">
                                                <select class="form-control select2" id="ItemType" name="ItemType">
                                                    <option value="">--- Select ---</option>
                                                    @foreach (var item in ViewBag.ItemType)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4 required">Store Location</label>
                                            <div class="input-group form-group col-md-8">
                                                <select class="form-control select2" id="FromLocCode" name="FromLocCode">
                                                    @foreach (var item in ViewBag.FromLocCode)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row col-md-12">
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4 required">Item</label>
                                            <div class="input-group form-group col-md-8">
                                                <select class="form-control select2" id="RecvItem" name="RecvItem">
                                                    @*<option>--- Select ---</option>*@
                                                    <option></option>
                                                    @foreach (var item in ViewBag.RecvItem)
                                                    {
                                                        <option value="@item.Value">@item.Text</option>
                                                    }
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4">Description</label>
                                            <div class="input-group form-group col-md-8">
                                                <input class="form-control" id="Description" name="Description" type="text" value="">
                                                <span class="field-validation-valid" data-valmsg-for="Description" data-valmsg-replace="true"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row col-md-12">
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4  required">Qty</label>
                                            <div class="input-group form-group col-md-8">
                                                <input class="form-control" id="Qty" name="Qty" type="text" value="">
                                                <span class="field-validation-valid" data-valmsg-for="Qty" data-valmsg-replace="true"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-6" style="padding:0px">
                                            <label class="col-md-4 required">Unit Price</label>
                                            <div class="input-group form-group col-md-8">
                                                <input class="form-control" id="Price" name="Price" type="text" value="">
                                                <span class="field-validation-valid" data-valmsg-for="Price" data-valmsg-replace="true"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12" style="text-align:right; padding:10px;">
                                        <input type="button" class="btn btn-primary" value="Add" id="btnAddRecvInPay" />
                                    </div>



                                    <div class="row col-md-12">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <br />
                                                <table class="table table-bordered table-responsive" id="RecvInPaymentModalGV" style="width:100%">
                                                    <thead>
                                                        <tr>
                                                            <th>SL</th>
                                                            <th>Code</th>
                                                            <th>Item&nbsp;Name</th>
                                                            <th>Qty</th>
                                                            <th>Price</th>
                                                            <th>Total&nbsp;Price</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="RecvInPaymentTbodyId"></tbody>

                                                </table>
                                                <br />
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal3" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Deposit To Bank</h3>

                            </div>
                            <div class="panel-body">

                                <div class="col-md-12">

                                    <label class="col-md-3" for="DepositNo">Deposit No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="DepositNo" name="DepositNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="DepositNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="DepositDate">Deposit Date</label>
                                    <div class="form-group col-md-6">
                                        <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="DepositDate" value="@ViewBag.Date" disabled="disabled">
                                        <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3" for="dVoucherNo">Voucher No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="dVoucherNo" name="dVoucherNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="dVoucherNo" data-valmsg-replace="true"></span>
                                    </div>
                                    @*<span class="bg-primary b-0 text-white" style="width: 130px; margin-top: 100px;" id="newVchr"><i class="md-sync"></i></span>*@
                                </div>

                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="DAccode">Bank A/C</label>
                                    <div class="form-group col-md-6">
                                        <select class="form-control select2"  id="DAccode" name="DAccode">
                                            <option>Select Bank A/C</option>
                                            @foreach (var item in ViewBag.BAccode)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-3 required" for="DAmount">Amount</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="DAmount"  name="DAmount" type="number" placeholder="0">
                                        <span class="field-validation-valid" data-valmsg-for="DAmount" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-3" for="DSlipNo">Deposit Slip No</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="DSlipNo"  name="DSlipNo" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="DSlipNo" data-valmsg-replace="true"></span>
                                    </div>
                                </div>

                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-6"></label>
                                        <input type="button" value="Save" class="btn btn-primary" id="saveDTB" />
                                        <input type="button" value="Update" class="btn btn-primary" id="updateDTB" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearDTB" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeDTB" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal4" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Issue</h3>

                            </div>
                            <div class="panel-body">

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="IssueNo">Issue No</label>
                                        <div class="form-group col-md-6">
                                            <input class="form-control" id="IssueNo" name="IssueNo" type="text" value="">
                                            <span class="field-validation-valid" data-valmsg-for="IssueNo" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="IssueDate">Issue Date</label>
                                        <div class="input-group form-group col-md-8">
                                            <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="IssueDate" value="@ViewBag.Date" >
                                            <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="FromLocCode">Store Location</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="FromLocCode" name="FromLocCode" >

                                                @foreach (var item in ViewBag.FromLocCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="DesLocCode">Destination</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="DesLocCode" name="DesLocCode" >

                                                @foreach (var item in ViewBag.DesLocCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssueToSubCode">Issue To</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="IssueToSubCode" name="IssueToSubCode" >
                                                @foreach (var item in ViewBag.IssueToSubCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssRefNo">Reference No</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssRefNo" name="IssRefNo" type="text" value="">
                                            <span class="field-validation-valid" data-valmsg-for="IssRefNo" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssRefDate">Reference Date</label>
                                        <div class="input-group form-group col-md-8">
                                            <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="IssRefDate" value="@ViewBag.Date" >
                                            <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssPurAccode">Purpose</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="IssPurAccode" name="IssPurAccode" >

                                                @foreach (var item in ViewBag.issPurAccode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                @*<div class="col-md-4"><br /><br /></div>*@<div class="col-md-4"><br /><br /></div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssItemCode">Item</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="IssItemCode" name="IssItemCode" >

                                                @foreach (var item in ViewBag.Item)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="IssDescription">Description</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssDescription" name="IssDescription" type="text" value="">
                                            @*<span class="field-validation-valid" data-valmsg-for="IssDescription" data-valmsg-replace="true"></span>*@<span class="field-validation-valid" data-valmsg-for="IssDescription" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="IssItemLotNo">Lot No</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssItemLotNo" name="IssItemLotNo" type="text" value="">
                                            @*<span class="field-validation-valid" data-valmsg-for="IssItemLotNo" data-valmsg-replace="true"></span>*@<span class="field-validation-valid" data-valmsg-for="IssItemLotNo" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="IssItemExQty">Existing Qty</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssItemExQty" name="IssItemExQty" type="text" value="">
                                            @*<span class="field-validation-valid" data-valmsg-for="IssItemExQty" data-valmsg-replace="true"></span>*@<span class="field-validation-valid" data-valmsg-for="IssItemExQty" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="IssItemQty">Qty</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssItemQty" name="IssItemQty" type="text" value="">
                                            @*<span class="field-validation-valid" data-valmsg-for="IssItemQty" data-valmsg-replace="true"></span>*@<span class="field-validation-valid" data-valmsg-for="IssItemQty" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="IssItemPrice">Price</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssItemPrice" name="IssItemPrice" type="text" value="">
                                            @*<span class="field-validation-valid" data-valmsg-for="IssItemPrice" data-valmsg-replace="true"></span>*@<span class="field-validation-valid" data-valmsg-for="IssItemPrice" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">

                                        <input type="button" class="btn btn-primary" value="Add" id="addIssItem" />

                                    </div>
                                </div>


                                <div class="row col-md-12" style="border:1px solid;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <br />
                                            <br />
                                            <table class="table table-bordered table-responsive" id="datatable-buttons2">
                                                <thead>
                                                    <tr>
                                                        <th>SL</th>
                                                        <th>Item</th>
                                                        <th>Qty</th>
                                                        <th>Price</th>
                                                        <th>Lot No</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbodyId2"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12" style="padding-top:10px">
                                    <label class="col-md-4" for="IssRemarks">Remarks</label>
                                    <div class="form-group col-md-8">
                                        <input class="form-control" id="IssRemarks" name="IssRemarks" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="IssRemarks" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssueByCode">Issued By</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="IssueByCode" name="IssueByCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.IssueByCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="IssAppByCode">Approved By</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="IssAppByCode" name="IssAppByCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.IssAppByCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="IssTime">Time</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="IssTime" name="remarks"  type="text" value="@DateTime.Now.ToString(" hh:mm:ss")">
                                        </div>

                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="IssDate">Date</label>
                                        <div class="input-group form-group col-md-8">
                                            <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="IssDate" value="@ViewBag.Date" >
                                            <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                        </div>
                                    </div>

                                </div>


                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-6"></label>
                                        <input type="button" value="Submit" class="btn btn-primary" id="saveIssue" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearIssue" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeIssue" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg " tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal5" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Receive</h3>

                            </div>
                            <div class="panel-body">

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="ReceiveNo">Receive No</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="ReceiveNo" name="ReceiveNo" type="text" value="">
                                            <span class="field-validation-valid" data-valmsg-for="ReceiveNo" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="ReceiveDate">Receive Date</label>
                                        <div class="input-group form-group col-md-8">
                                            <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="ReceiveDate" value="@ViewBag.Date" >
                                            <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="FromLocCode">Store Location</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="FromLocCode" name="FromLocCode" >

                                                @foreach (var item in ViewBag.FromLocCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>



                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="SourceCode">Source</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="SourceCode" name="SourceCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.Source)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>

                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="ReceiveFromSubCode">Receive From</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="ReceiveFromSubCode" name="ReceiveFromSubCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.ReceiveFrom)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>




                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="RcvRefNo">Reference No</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvRefNo" name="RcvRefNo" type="text" value="">
                                            <span class="field-validation-valid" data-valmsg-for="RcvRefNo" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="RcvRefDate">Reference Date</label>
                                        <div class="input-group form-group col-md-8">
                                            <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="RcvRefDate" value="@ViewBag.Date" >
                                            <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="RcvPurAccode">Purpose</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="RcvPurAccode" name="RcvPurAccode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.rcvPurAccode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="RcvItemCode">Item</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="RcvItemCode" name="RcvItemCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.Item)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="IssDescription">Description</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvDescription" name="RcvDescription" type="text" value="">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="RcvItemLotNo">Lot No</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvItemLotNo" name="RcvItemLotNo" type="text" value="">

                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="RcvItemExQty">Existing Qty</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvItemExQty" name="RcvItemExQty" type="text" value="">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="RcvItemQty">Qty</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvItemQty" name="RcvItemQty" type="text" value="">
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="RcvItemPrice">Price</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvItemPrice" name="RcvItemPrice" type="text" value="">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="col-md-4 required" for="BadQty">Bad Qty</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="BadQty" name="BadQty" type="text" value="">
                                            <span class="field-validation-valid" data-valmsg-for="BadQty" data-valmsg-replace="true"></span>
                                        </div>
                                    </div>
                                </div>




                                <div class="col-md-12">
                                    <br />
                                    <div class="col-md-6" style="text-align:right; margin-left:100px;">
                                        <input type="button" class="btn btn-primary" value="Add" id="addRcvItem" />
                                    </div>
                                </div>

                                <div class="row col-md-12" style="border:1px solid;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <br />
                                            <br />
                                            <table class="table table-bordered table-responsive" id="datatable-buttons3">
                                                <thead>
                                                    <tr>
                                                        <th>SL</th>
                                                        <th>Item</th>
                                                        <th>Qty</th>
                                                        <th>Bad Qty</th>
                                                        <th>Price</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbodyId3"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12" style="padding-top:10px">
                                    <label class="col-md-4 required" for="RcvRemarks">Remarks</label>
                                    <div class="form-group col-md-4">
                                        <input class="form-control" id="RcvRemarks" name="RcvRemarks"  type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="RcvRemarks" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="ReceiveByCode">Received By</label>
                                        <div class="form-group col-md-6">
                                            <select class="form-control select2" id="ReceiveByCode" name="ReceiveByCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.RcvdByCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4 required" for="RcvAppByCode">Approved By</label>
                                        <div class="form-group col-md-8">
                                            <select class="form-control select2" id="RcvAppByCode" name="RcvAppByCode" >
                                                <option>-----Select-----</option>
                                                @foreach (var item in ViewBag.RcvAppByCode)
                                                {
                                                    <option value="@item.Value">@item.Text</option>
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="RcvTime">Time</label>
                                        <div class="form-group col-md-8">
                                            <input class="form-control" id="RcvTime" name="RcvTime"  type="text" value="@DateTime.Now.ToString(" hh:mm:ss")">
                                        </div>

                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <label class="col-md-4" for="RcvDate">Date</label>
                                        <div class="input-group form-group col-md-8">
                                            <input type="text" class="form-control datePage" placeholder="dd/mm/yyyy" id="RcvDate" value="@ViewBag.Date" >
                                            <span class="input-group-addon bg-primary b-0 text-white"><i class="ion-calendar"></i></span>
                                        </div>
                                    </div>

                                </div>


                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-6"></label>
                                        <input type="button" value="Submit" class="btn btn-primary" id="saveReceive" />
                                        <input type="button" value="Update" class="btn btn-primary" id="updateReceive" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearReceive" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeReceive" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal6" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Add Subsidiary</h3>

                            </div>
                            <div class="panel-body">
                                <div class="col-md-12">
                                    <label class="col-md-4 required" for="SubsidiaryCode">Subsidiary</label>
                                    <div class="form-group col-md-8">
                                        <select class="form-control select2" id="SubsidiaryCode" name="SubsidiaryCode" >
                                            <option>--- Select ---</option>
                                            @foreach (var item in ViewBag.SubCode)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>

                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4" for="SubDescription">Description</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="SubDescription" name="SubDescription" type="text" value="">
                                        <span class="field-validation-valid" data-valmsg-for="SubDescription" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4 required" for="SubAmount">Amount</label>
                                    <div class="form-group col-md-6">
                                        <input class="form-control" id="SubAmount" name="SubAmount" type="text" placeholder="0" >
                                        <span class="field-validation-valid" data-valmsg-for="SubAmount" data-valmsg-replace="true"></span>
                                    </div>
                                </div>
                                <div id="pnlSubTbl">
                                    <div class="col-md-12">
                                        <br />
                                        <div class="col-md-6" style="text-align:right; margin-left:100px;">
                                            <input type="button" class="btn btn-primary" value="Add" id="addSubsidiary" />
                                        </div>
                                    </div>

                                    <div class="row col-md-12" style="margin-left:20px">
                                        <div class="row">
                                            <div class="col-md-11">
                                                <br />
                                                <br />
                                                <table class="table table-bordered table-responsive" id="datatable-buttons4">
                                                    <thead>
                                                        <tr>
                                                            <th>SL</th>
                                                            <th>Name</th>
                                                            <th>Amount</th>
                                                            <th>Action</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="tbodyId4"></tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row col-md-12">
                                    <div class="col-md-12">
                                        <label for="select2-chosen-1" class="col-md-6"></label>
                                        <input type="button" value="Submit" class="btn btn-primary" id="saveSubsidiary" />
                                        <input type="button" value="Clear" class="btn btn-primary" id="clearSubsidiary" />
                                        <input type="button" value="Close" class="btn btn-primary" id="closeSubsidiary" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    
    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="Addmodal7" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Add Subsidiary</h3>

                            </div>
                            <div class="panel-body">
                                <div class="col-md-12">
                                    <label class="col-md-4">Group</label>                                                                      

                                    <div class="input-group form-group col-md-8">
                                        <select class="form-control select2" id="GroupID" name="GroupID" >
                                            @foreach (var item in ViewBag.Group)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4">Sub Group</label>
                                    <div class="input-group form-group col-md-8">
                                        <select class="form-control select2" id="SGroupID" name="SGroupID" >
                                            @foreach (var item in ViewBag.SubGroup)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4">Sub Sub Group</label>
                                    <div class="input-group form-group col-md-8">
                                        <select class="form-control select2" id="SSGroupID" name="SSGroupID" required="required">
                                            @foreach (var item in ViewBag.SubSubGroup)
                                            {
                                                <option value="@item.Value">@item.Text</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div>
                                        <div class="pull-right">
                                            <input type="button" id="btnOk" value="O k" class="btn btn-primary" />
                                            <input type="button" id="closePopOver" value="Close" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" id="JobModal" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-color panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">Job Information</h3>

                            </div>
                            <div class="panel-body">
                                <div class="clearfix">
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-3">Job No</label>
                                    <div class="input-group form-group col-md-7">
                                        <input type="text" class="form-control" id="nJobNo" name="nJobNo" />
                                    </div>
                                </div>
                                <div class="col-md-10">
                                    <div>
                                        <div class="pull-right">
                                            <input type="button" id="btnJobOk" value="Save" class="btn btn-primary" />
                                            <input type="button" id="closeJob" value="Close" class="btn btn-primary" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

}





@section Scripts{
    <script src="/App_Themes/Theme1/plugins/select2/select2.min.js"></script>
    <script src="~/App_Themes/Theme1/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
    <script>
    $(document).ready(function () {
        $('#print').hide();
        $('#Accode').select2();
        $('#CustCode').select2();
        $("#update").hide();
        $("#UpdateHOR").hide();
        $("#saveExpense").hide();
        $("#saveDTB").show();
        $("#updateDTB").hide();
        $("#datatable").DataTable();
        $("#subsidiary").hide();
        $("#crSubsidiary").hide();
        $("#exSubsidiary").hide();
        $("#UpdateCRWithSub").hide();
        $("#UpdateExWithSub").hide();


        jQuery("#TrDate").datepicker({
            autoclose: true,
            todayHighlight: true
        });
        jQuery("#ReceiptDate").datepicker({
            autoclose: true,
            todayHighlight: true
        });
        $("#UpdateCashReceipt").hide();
        $('#datatable-buttons').dataTable();
        $('#datatable-buttons1').dataTable();
        $('#datatable-buttons2').dataTable();
        $('#datatable-buttons3').dataTable();
        $('#datatable-buttons4').dataTable();



        //For GLEntries
        $("#GLEntries").click(function () {
            //Get the id of the selected item in dropdown
            var TrDate = moment($('#TrDate').val(), 'DD/MM/YYYY').format('MM/DD/YYYY').toString();

            var id = TrDate + '&pageType=COR';

            //Replace the predifined QueryString param "xxx" with the "id"
            this.href = this.href.replace("blankDate", id);
        });

        //For COP
        $("#glgo").click(function () {
            //Get the id of the selected item in dropdown
            var TrDate = moment($('#TrDate').val(), 'DD/MM/YYYY').format('MM/DD/YYYY').toString();

            var id = TrDate + '&pageType=COP';

            //Replace the predifined QueryString param "xxx" with the "id"
            this.href = this.href.replace("blankDate", id);
        });

        //For GLEntries
        $("#GLEntriesp   ").click(function () {
            //Get the id of the selected item in dropdown
            var TrDate = moment($('#TrDate').val(), 'DD/MM/YYYY').format('MM/DD/YYYY').toString();

            var id = TrDate + '&pageType=COP';

            //Replace the predifined QueryString param "xxx" with the "id"
            this.href = this.href.replace("blankDate", id);
        });

        //For COR
        $("#glgoR").click(function () {
            //Get the id of the selected item in dropdown
            var TrDate = moment($('#TrDate').val(), 'DD/MM/YYYY').format('MM/DD/YYYY').toString();

            var id = TrDate + '&pageType=COR';

            //Replace the predifined QueryString param "xxx" with the "id"
            this.href = this.href.replace("blankDate", id);
        });



        function startTime() {
            var today = new Date();
            var h = today.getHours();
            var m = today.getMinutes();
            var s = today.getSeconds();
            m = checkTime(m);
            s = checkTime(s);
            document.getElementById('#ReceiptTime').innerHTML =
            h + ":" + m + ":" + s;
            var t = setTimeout(startTime, 500);
        }
        function checkTime(i) {
            if (i < 10) { i = "0" + i };
            return i;
        }

        jQuery("#RemitDate").datepicker({
            autoclose: true,
            todayHighlight: true
        });

        jQuery("#ExpenseDate").datepicker({
            autoclose: true,
            todayHighlight: true
        });
        jQuery("#DepositDate").datepicker({
            autoclose: true,
            todayHighlight: true
        });


        //For GL Permission By Farhad
        var ispType = '@ViewBag.errMsg';
        if (ispType != '') {
            ispType = '@ViewBag.errMsg';
            }
            if (ispType == "VWP") {
                alert("No Voucher waiting for posting Permission for this User");
            } else if (ispType == "VL") {
                alert("No List Of vouchers Permission for this User");
            }
            else if (ispType == "P") {
                alert("No View Permission for this User");
            }
            else if (ispType == "E") {
                alert("Data Not Found..!");
            }

        /////*************************Job No****************************//////
            //$("#JobNo").select2();
            $(document).on("click", "#btnJob", function () {
                $("#JobModal").modal("show");
            });
            $(document).on("click", "#closeJob", function (e) {
                e.preventDefault();
                $('#JobModal').modal('hide');
            });

            $(document).on("click", "#btnJobOk", function (e) {
                if ($("#nJobNo").val() != "") {
                    $.ajax({
                        url: '@Url.Action("LoadandSaveJob", "Sales")',
                        contentType: "application/json;charset=utf-8",
                        data: {
                            nJobNo: $("#nJobNo").val()
                        },
                        type: 'GET',
                        dataType: 'json',
                        success: function (data) {
                            $('#JobNo').empty();
                            //data.insertBefore('<option>', { Value: "", text: "--- Select ---" });
                            $.each(data, function (index, value) {
                                $('#JobNo').append($('<option>',
                                    {
                                        value: value.Value,
                                        text: value.Text
                                    })).select2();
                            });
                            $.each(data, function (index, value) {
                                $('#expJobNo').append($('<option>',
                                    {
                                        value: value.Value,
                                        text: value.Text
                                    })).select2();
                            });
                            $('#JobModal').modal('hide');
                            $("#nJobNo").val("");
                        }
                    });
                }
                else {
                    alert("Job No is required.");
                    return;
                }

            })


            /////*************************Cash Receipt****************************//////
            $('#purAccode').select2();
            $(document).on('click', '#addModalButton', function () {
                $("#saveCashReceipt").show();
                $("#saveCRWithIssue").hide();
                $("#saveCRWithSub").hide();
                $("#UpdateCashReceipt").hide();
                $('#Addmodal').modal('show');
                $.ajax({
                    url: '@Url.Action("GetReceiptNo", "CashReceipt")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#ReceiptNo").val(datas);
                }
            });

            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "CashReceipt")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'CR' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#VoucherNo").val(datas);
                }
            });
        });
        $(document).on("click", "#newVchr", function () {
            $("#addModalButton").show();
            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "CashReceipt")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'CR' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    if (datas != 0) {
                        $("#VoucherNo").val(datas);
                    }
                }
            })
        });
        $(document).on("change", "#purAccode", function () {
            var order = { purAccode: "" };

            $.ajax({
                url: '@Url.Action("ChechSubStock", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: {
                    purAccode: $("#purAccode").val()
                },
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    if (data == 2) {
                        $("#saveCashReceipt").hide();
                        $("#saveCRWithIssue").hide();
                        $("#saveCRWithSub").show();
                        $("#UpdateCashReceipt").hide();
                        if ("@ViewBag.MrConv" != "C") {
                            $("#pnlSubTbl").hide();
                        }
                        $.ajax({
                            url: '@Url.Action("GetSubsidiaryByPurpose", "CashOperation")',
                            contentType: "application/json;charset=utf-8",
                            data: {
                                purAccode: $("#purAccode").val()
                            },
                            type: 'GET',
                            dataType: 'json',
                            success: function (data) {
                                $('#SubsidiaryCode').empty();
                                $.each(data, function (index, value) {
                                    $('#SubsidiaryCode').append($('<option>',
                                        {
                                            value: value.Value,
                                            text: value.Text
                                        })).select2();
                                });
                                $("#SubsidiaryCode").val(orders.SubsidiaryCode).trigger('change');
                                orders.SubsidiaryCode = "0";
                            }
                        });
                        $('#Addmodal6').modal('show');

                    }
                    else {
                        $("#saveCRWithSub").hide();
                    }

                }
            });
        });


        $(document).on("change", "#IssItemCode", function (e) {

            $.ajax({
                type: "Get",
                contentType: "application/json;charset=utf-8",
                url: '@Url.Action("GetItemByQtyPrice", "CashOperation")',
                data: { Item: $("#IssItemCode").val() },
                dataType: 'json',
                success: function (item) {
                    if (item == 0) {
                        alert("Data Not Found");
                        clearItemInfo();
                    }
                    else {
                        $("#IssItemExQty").val(item.CurrQty);
                        $("#IssItemPrice").val(item.UnitPrice);
                        $("#IssItemLotNo").val(item.LotNo);
                    }
                }
            });

        });

        var orders = [];
        $('#addIssItem').click(function () {
            addOnList();
            clearItemInfo();

        });
        function clearItemInfo() {
            $("#IssItemExQty").val("");
            $("#IssItemQty").val("");
            $("#IssItemPrice").val("");
            $("#IssItemLotNo").val("");
            $("#IssDescription").val("");
        }

        function addOnList() {
            var newAddList = [];
            var newAddListSl = 0;

            var IssueNo = $("#IssueNo").val();
            var ItemCode = $("#IssItemCode option:selected").val();
            var Description = $("#IssDescription").val();
            var Qty = $("#IssItemQty").val();
            var LotNo = $("#IssItemLotNo").val();
            var Price = $("#IssItemPrice").val();
            var ExQty = $("#IssItemExQty").val();
            var ItemName = $('#IssItemCode option:selected').text();
            var SubCode = $("#IssueToSubCode").val();

            if (Qty != "") {
                var item = {
                    ItemCode: ItemCode, Description: Description, Qty: Qty, LotNo: LotNo,
                    Price: Price, ExQty: ExQty, Sl: 0, ItemName: ItemName, IssueNo: IssueNo, SubCode: SubCode
                }
                item.Sl = orders.length + 1
                orders.push(item);
                addOnTable();
            }
            else {
                swal(
                     'Sorry!',
                     'Something went wrong please try again!',
                     'warning'
                 );

            }
        }
        $(document).on('click', '#deleteTmpIssueItem', function () {
            var id = $(this).attr("value");

            swal({
                title: "Are you sure?",
                text: "You will not be able to recover this order data!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!",
                closeOnConfirm: true
            },
             function () {
                 deleteRow(id);
                 addOnTable();
                 swal("Deleted!", "Your imaginary file has been deleted.", "success");

             });
        });
        function deleteRow(sl) {
            var newOrder = [];
            var newSl = 0;

            $.each(orders, function (index, data) {

                if (data.Sl != sl) {
                    newSl++;
                    data.Sl = newSl;
                    data.Id = 0;
                    newOrder.push(data);
                }
            });
            orders = new Array();
            orders = newOrder;

        }

        function addOnTable() {

            $('#tbodyId2').empty();
            var sl = 0;
            var amount = 0.0;
            //var price = 0.0;
            $.each(orders, function (index, data) {
                sl = sl + 1;
                data.Sl = sl;
                //price = data.Qty * data.price;
                $("#tbodyId2").append("<tr><td>" + sl + "</td><td>"
                    + data.ItemName + "</td><td>"
                    + data.Qty + "</td><td>"
                    + data.Qty * data.Price + "</td><td>"
                    + data.LotNo + "</td><td>"
                    + '<a href="#" class="on-default remove-row deleteSup" data-id="' + sl + '" id="deleteTmpIssueItem" value="' + sl + '"><i class="glyphicon glyphicon-trash"></i></a>' + "</td></tr>");
                amount += data.price;
            });
            $("#Amount").val(amount);

        }


        $(document).on("click", "#saveIssue", function () {


            $('#Addmodal4').modal('hide');

        });

        $(document).on("click", "#closeIssue", function () {

            $('#Addmodal4').modal('hide');

        });

        $(document).on("click", "#saveCRWithIssue", function () {
            $("#saveCRWithIssue").prop("disabled", false);
            var cashReceipt = {
                ReceiptNo: "", ReceiptDate: "", purAccode: "", VoucherNo: "", RefNo: "", Amount: 0, Advance: false, Remarks: ""
            };

            cashReceipt.ReceiptNo = $("#ReceiptNo").val();
            cashReceipt.ReceiptDate = $("#ReceiptDate").val();
            cashReceipt.purAccode = $("#purAccode").val();
            cashReceipt.VoucherNo = $("#VoucherNo").val();
            cashReceipt.RefNo = $("#RefNo").val();
            cashReceipt.Amount = parseFloat($("#Amount").val()).toFixed(2).replace(".", ",");  
            cashReceipt.Advance = $("#Advance").prop("checked");
            cashReceipt.Remarks = $("#Remarks").val();

            var issueInfo = {
                IssueNo: "", IssueDate: "", FromLocCode: "", IssueToSubCode: "", DesLocCode: "", RefNo: "", Accode: "", ItemCode: "", Description: "",
                Qty: "", ExQty: "", Price: "", LotNo: "", IssDate: "", RefDate: "", Remarks: "",
                IssueByCode: "", AppByCode: "", IssTime: ""
            };

            issueInfo.IssueNo = $("#IssueNo").val();
            issueInfo.IssueDate = $("#IssueDate").val();
            issueInfo.FromLocCode = $("#FromLocCode").val();
            issueInfo.IssueToSubCode = $("#IssueToSubCode").val();
            issueInfo.DesLocCode = $("#DesLocCode").val();
            issueInfo.RefNo = $("#IssRefNo").val();
            issueInfo.RefDate = $("#IssRefDate").val();
            issueInfo.Accode = $("#IssPurAccode").val();
            issueInfo.ItemCode = $("#IssItemCode").val();
            issueInfo.Description = $("#IssDescription").val();
            issueInfo.Qty = $("#IssItemQty").val();
            issueInfo.ExQty = $("#IssItemExQty").val();
            issueInfo.Price = $("#IssItemPrice").val();
            issueInfo.LotNo = $("#IssItemLotNo").val();
            issueInfo.Remarks = $("#IssRemarks").val();
            issueInfo.IssueByCode = $("#IssueByCode").val();
            issueInfo.AppByCode = $("#IssAppByCode").val();
            issueInfo.IssTime = $("#IssTime").val();
            issueInfo.IssDate = $("#IssDate").val();

            if (parseFloat(cashReceipt.Amount) <= 0 || !cashReceipt.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("SaveCRWithIssue", "CashReceipt")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ cashReceipt: cashReceipt, issueMain: issueInfo, issueDetails: orders }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveCashReceipt").prop("disabled", false);
                            clearCashReceipt();
                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveCashReceipt").prop("disabled", false);
                        }
                        else {
                            swal("Sucessfully Saved!", "success")
                            $("#saveCashReceipt").prop("disabled", false);
                            AddOnCashReceiptAndWithdraw(datas);
                            clearCashReceipt();
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveCashReceipt").prop("disabled", true);
                    }
                });
            }

        });



        $(document).on("click", "#saveCRWithSub", function () {
            $("#saveCRWithSub").prop("disabled", false);
            var cashReceipt = {
                ReceiptNo: "",
                ReceiptDate: "",
                purAccode: "",
                VoucherNo: "",
                RefNo: "",
                Amount: 0,
                Advance: false,
                Remarks: "",
                JobNo: ""
            };
            cashReceipt.ReceiptNo = $("#ReceiptNo").val();
            cashReceipt.ReceiptDate = $("#ReceiptDate").val();
            cashReceipt.purAccode = $("#purAccode").val();
            cashReceipt.JobNo = $("#JobNo").val();
            cashReceipt.VoucherNo = $("#VoucherNo").val();
            cashReceipt.RefNo = $("#RefNo").val();
            cashReceipt.Amount = parseFloat($("#Amount").val()).toFixed(2).replace(".", ",");  
            cashReceipt.Advance = $("#Advance").prop("checked");
            cashReceipt.Remarks = $("#Remarks").val();
            if (parseFloat(cashReceipt.Amount) <= 0 || !cashReceipt.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("SaveCRWithSubsidiary", "CashReceipt")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ cashReceipt: cashReceipt, crDetails: subOrders }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveCRWithSub").prop("disabled", false);
                            $("#saveCRWithSub").hide();
                            $("#saveCashReceipt").show();
                            clearCashReceipt();
                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveCashReceipt").prop("disabled", false);
                        }
                        else {
                            //swal("Sucessfully Saved!", "success");
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            });
                            AddOnCashReceiptAndWithdraw(datas);
                            clearCashReceipt();
                            $("#tbodyId4").empty();
                            subOrders = [];
                            $$("#saveCRWithSub").prop("disabled", false);
                            $("#saveCRWithSub").hide();
                            $("#saveCashReceipt").show();

                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveCRWithSub").prop("disabled", true);
                    }
                });
            }

        });

        $(document).on("click", "#UpdateCRWithSub", function () {
            $("#UpdateCRWithSub").prop("disabled", false);
            var cashReceipt = {
                ReceiptNo: "",
                ReceiptDate: "",
                purAccode: "",
                VoucherNo: "",
                RefNo: "",
                Amount: 0,
                Advance: false,
                Remarks: "",
                JobNo: ""
            };
            cashReceipt.ReceiptNo = $("#ReceiptNo").val();
            cashReceipt.ReceiptDate = $("#ReceiptDate").val();
            cashReceipt.purAccode = $("#purAccode").val();
            cashReceipt.JobNo = $("#JobNo").val();
            cashReceipt.VoucherNo = $("#VoucherNo").val();
            cashReceipt.RefNo = $("#RefNo").val();
            cashReceipt.Amount = parseFloat($("#Amount").val()).toFixed(2).replace(".", ",");  
            cashReceipt.Advance = $("#Advance").prop("checked");
            cashReceipt.Remarks = $("#Remarks").val();
            if (parseFloat(cashReceipt.Amount) <= 0 || !cashReceipt.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("UpdateCRWithSubsidiary", "CashReceipt")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ cashReceipt: cashReceipt, crDetails: subOrders }),//, dateTime: moment($("#ReceiptDate").val()).format("MM-DD-YYYY")}
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveCRWithSub").prop("disabled", false);
                            $("#saveCRWithSub").hide();
                            $("#saveCashReceipt").show();
                            clearCashReceipt();
                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveCashReceipt").prop("disabled", false);
                        }
                        else {
                            swal("Sucessfully Update!", "success");
                            AddOnCashReceiptAndWithdraw(datas);
                            clearCashReceipt();
                            $("#tbodyId4").empty();
                            subOrders = [];
                            $$("#saveCRWithSub").prop("disabled", false);
                            $("#saveCRWithSub").hide();
                            $("#saveCashReceipt").show();

                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveCRWithSub").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#saveCashReceipt", function () {
            $("#saveCashReceipt").prop("disabled", false);
            var cashReceipt = {
                ReceiptNo: "", ReceiptDate: "", purAccode: "", VoucherNo: "", RefNo: "", Amount: 0, Advance: false, Remarks: "", JobNo:""
            };
            cashReceipt.ReceiptNo = $("#ReceiptNo").val();
            cashReceipt.ReceiptDate = $("#ReceiptDate").val();
            cashReceipt.purAccode = $("#purAccode").val();
            cashReceipt.VoucherNo = $("#VoucherNo").val();
            cashReceipt.RefNo = $("#RefNo").val();
            cashReceipt.Amount = parseFloat($("#Amount").val()).toFixed(2).replace(".", ",");  
            cashReceipt.Advance = $("#Advance").prop("checked");
            cashReceipt.Remarks = $("#Remarks").val();
            cashReceipt.JobNo = $("#JobNo").val();
            if (parseFloat(cashReceipt.Amount) <= 0 || !cashReceipt.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("SaveCashReceipt", "CashReceipt")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ cashReceipt: cashReceipt }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveCashReceipt").prop("disabled", false);
                            clearCashReceipt();
                        }
                        else if (datas == "X") {
                            swal({
                                title: "Sorry",
                                text: "No Save Permission for this User",
                                type: "warning"
                            });
                        }
                        else if (datas == 1) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveCashReceipt").prop("disabled", false);
                        }
                        else if (datas == 3) {
                            swal({
                                title: "Already exists!",
                                text: "Please try again!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("CashReceiptNoIncreement", "CashReceipt")',
                                    contentType: "application/json;charset=utf-8",
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#ReceiptNo").val(datas);
                                    }
                                });
                            });
                            $("#save").prop("disabled", false);
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("GetNewVoucherNo", "CashReceipt")',
                                    contentType: "application/json;charset=utf-8",
                                    data: { VType: 'CR' },
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#VoucherNo").val(datas);
                                    }
                                });
                            });
                            $("#saveCashReceipt").prop("disabled", false);
                            AddOnCashReceiptAndWithdraw(datas);
                            clearCashReceipt();

                        }

                    },
                    error: function (datas) {
                        swal(datas, "warning")
                        $("#saveCashReceipt").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#UpdateCashReceipt", function () {
            $("#UpdateCashReceipt").prop("disabled", false);
            var cashReceipt = {
                ReceiptNo: "", ReceiptDate: "", purAccode: "", VoucherNo: "", RefNo: "", Amount: 0, Advance: false, Remarks: "", JobNo:""
            };

            var date = $("#ReceiptDate").val();

            cashReceipt.ReceiptNo = $("#ReceiptNo").val();
            cashReceipt.ReceiptDate = $("#ReceiptDate").val();
            cashReceipt.purAccode = $("#purAccode").val();
            cashReceipt.VoucherNo = $("#VoucherNo").val();
            cashReceipt.RefNo = $("#RefNo").val(); 
            cashReceipt.JobNo = $("#JobNo").val();
            cashReceipt.Amount = parseFloat($("#Amount").val()).toFixed(2).replace(".", ",");  
            cashReceipt.Advance = $("#Advance").prop("checked");
            cashReceipt.Remarks = $("#Remarks").val();
            if (parseFloat(cashReceipt.Amount) <= 0 || !cashReceipt.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("UpdateCashReceipt", "CashReceipt")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ cashReceipt: cashReceipt, dateTime: $("#ReceiptDate").val() }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#UpdateCashReceipt").prop("disabled", false);


                        }
                        else if (datas == 2) {
                            swal(
                               'Sorry!',
                               'Cash is already closed. You are not allowed to update any data!!!',
                               'warning'
                           );
                            AddOnCashReceiptAndWithdraw(datas);
                            clearCashReceipt();
                        }
                        else if (datas == "U") {
                            swal({
                                title: "Sorry",
                                text: "No Update Permission for this User",
                                type: "warning"
                            });
                        }
                        else if ($.isArray(datas)) {
                            swal({
                                title: "Ok",
                                text: "Update Sucessfully!",
                                type: "success"
                            });
                            $("#UpdateCashReceipt").prop("disabled", false);
                            AddOnCashReceiptAndWithdraw(datas);
                            clearCashReceipt();
                        }

                    },
                    //error: function (datas) {
                    //    swal("There is network connection error! or Critical system error (Try again!)", "warning")
                    //    $("#UpdateCashReceipt").prop("disabled", true);
                    //}

                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert(errorThrown.text);
                    }


                });
            }

        });



        $(document).on("click", "#closeCashReceipt", function () {
            $('#Addmodal').modal('hide');
            //location.reload();
            $.ajax({
                url: '@Url.Action("GetGlECount", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'COR' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#CountNo").html('('+datas+')');
                }
            });
            clearCashReceipt();

        });


        $(document).on("click", "#clearCashReceipt", function () {
            clearCashReceipt();
        });

        function clearCashReceipt() {

            $("#ReceiptNo").val("");
            @*$("#ReceiptDate").val("@DateTime.Today.ToString("MM/dd/yyyy")");*@
            $("#purAccode").val($('#purAccode option:first-child').val()).trigger('change.select2');
            $("#VoucherNo").val("");
            $("#RefNo").val("");
            $("#Amount").val("");
            $("#Advance").prop("checked", false);
            $("#Remarks").val("");

            $("#saveCashReceipt").show();
            $("#UpdateCashReceipt").hide();
            $("#UpdateCRWithSub").hide();
            $("#saveCRWithSub").hide();

            $.ajax({
                url: '@Url.Action("GetReceiptNo", "CashReceipt")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#ReceiptNo").val(datas);
                }
            });

            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "CashReceipt")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'CR' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#VoucherNo").val(datas);
                }
            });

        }


        /////*************************Withdraw****************************//////


        $('#WAccode').select2();
        $(document).on('click', '#addModalButton1', function () {
            $('#Addmodal1').modal('show');
            $('#saveWithdraw').show();
            $('#UpdateWithdraw').hide();
            $.ajax({
                url: '@Url.Action("GetWithdrawNo", "Withdraw")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#withdrawNo").val(datas);
                }
            });
            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "Withdraw")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'BW', TrDate: $("#TrDate").val() },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#wVoucherNo").val(datas);
                }
            });


            $(document).on("click", "#newVchr", function () {
                $("#addModalButton").show();
                $.ajax({
                    url: '@Url.Action("GetNewVoucherNo", "Withdraw")',
                    contentType: "application/json;charset=utf-8",
                    data: { VType: 'BW' },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas != 0) {
                            $("#wVoucherNo").val(datas);
                        }
                    }
                })
            });



        });

        $(document).on("click", "#saveWithdraw", function () {

            var withdraw = { WithdrawDate: "", WithdrawNo: "", VoucherNo: "", ChequeNo: "", ChequeNo: "", Amount: "", bankAccode: "" }

            $("#saveWithdraw").prop("disabled", false);
            var date = $("#withdrawDate").val();
            withdraw.WithdrawDate = date;//$("#WithdrawDate").val(); //moment($("#WithdrawDate").val()).format("MM-DD-YYYY");
            withdraw.WithdrawNo = $("#withdrawNo").val();
            withdraw.VoucherNo = $("#wVoucherNo").val();
            withdraw.ChequeNo = $("#wChequeNo").val();
            withdraw.Amount = parseFloat($("#wAmount").val()).toFixed(2).replace(".", ",");  
            withdraw.bankAccode = $("#WAccode").val();

            if (parseFloat(withdraw.Amount) <= 0 || !withdraw.Amount.trim()) {
                alert("Amount is Required");
            }
            else if (parseFloat(withdraw.ChequeNo) <= 0 || !withdraw.ChequeNo.trim()) {
                alert("Cheque No is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("SaveWithdraw", "Withdraw")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ withdraw: withdraw }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveWithdraw").prop("disabled", false);
                            clearWithdraw();

                        }
                        else if (datas == "X") {
                            swal({
                                title: "Sorry",
                                text: "No Save Permission for this User",
                                type: "warning"
                            });
                        }
                        else if (datas == 1) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveWithdraw").prop("disabled", false);
                        }
                        else if (datas == 3) {
                            swal({
                                title: "Save Failed!!!",
                                text: "Already exists Please try again!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("WithdrawNoIncreement", "Withdraw")',
                                    contentType: "application/json;charset=utf-8",
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#withdrawNo").val(datas);
                                    }
                                });
                            });
                            $("#save").prop("disabled", false);
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("GetNewVoucherNo", "Withdraw")',
                                    contentType: "application/json;charset=utf-8",
                                    data: { VType: 'BW', TrDate: $("#TrDate").val() },
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#wVoucherNo").val(datas);
                                    }
                                });
                            });
                            $("#saveWithdraw").prop("disabled", false);
                            AddOnCashReceiptAndWithdraw(datas);
                            clearWithdraw();
                        }


                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveWithdraw").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#UpdateWithdraw", function () {

            $("#UpdateWithdraw").prop("disabled", false);

            var withdraw = { WithdrawDate: "", WithdrawNo: "", VoucherNo: "", ChequeNo: "", Amount: "", bankAccode: "" }
            var date = $("#withdrawDate").val();
            withdraw.WithdrawDate = date;
            withdraw.WithdrawNo = $("#withdrawNo").val();
            withdraw.VoucherNo = $("#wVoucherNo").val();
            withdraw.ChequeNo = $("#wChequeNo").val();
            withdraw.Amount = parseFloat($("#wAmount").val()).toFixed(2).replace(".", ",");  
            withdraw.bankAccode = $("#WAccode").val();

            if (parseFloat(withdraw.Amount) <= 0 || !withdraw.Amount.trim()) {
                alert("Amount is Required");
            }
            else if (parseFloat(withdraw.ChequeNo) <= 0 || !withdraw.ChequeNo.trim()) {
                alert("Cheque No is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("UpdateWithdraw", "Withdraw")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ withdraw: withdraw, dateTime: date }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Sorry!',
                                'Cash is already closed. You are not allowed to update any data!!!',
                                'warning'
                            );
                            $("#UpdateWithdraw").prop("disabled", false);
                            clearWithdraw();
                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#UpdateWithdraw").prop("disabled", false);
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Sucessfully Updated!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("GetNewVoucherNo", "Withdraw")',
                                    contentType: "application/json;charset=utf-8",
                                    data: { VType: 'BW', TrDate: $("#TrDate").val() },
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#wVoucherNo").val(datas);
                                    }
                                });
                            });
                            $("#UpdateWithdraw").prop("disabled", false);
                            AddOnCashReceiptAndWithdraw(datas);
                            clearWithdraw();
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#UpdateWithdraw").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#closeWithdraw", function () {
            $('#Addmodal1').modal('hide');
            //location.reload();
            $.ajax({
                url: '@Url.Action("GetGlECount", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'COR' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#CountNo").html('('+datas+')');
                }
            });
        });

        $(document).on("click", "#clearWithdraw", function () {
            clearWithdraw();
        });

        function clearWithdraw() {

            $("#withdrawNo").val("");
            @*$("#WithdrawDate").val("@DateTime.Today.ToString("MM/dd/yyyy")");*@
            $("#wChequeNo").val("");
            $("#wAmount").val("");
            $("#wVoucherNo").val("");
            $("#WAccode").val($('#WAccode option:first-child').val()).trigger('change.select2');
            $('#saveWithdraw').show();
            $('#UpdateWithdraw').hide();
            $.ajax({
                url: '@Url.Action("GetWithdrawNo", "Withdraw")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#withdrawNo").val(datas);
                }
            });
            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "Withdraw")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'BW' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#wVoucherNo").val(datas);
                }
            });
        }






        /////*************************Expense****************************//////



        //For Item Filtering
        $(document).on("change", "#ItemType", function (e) {
            if ($("#ItemType option:selected").val() != "") {
                $('#Addmodal7').modal('show');
            
            //for group load by itemtype.......
            $.ajax({
                url: '@Url.Action("LoadGroupInfoByItemType", "Sales")',
                contentType: "application/json;charset=utf-8",
                data: {
                    ItemType: $("#ItemType").val()
                },
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#GroupID').empty();
                    //data.insertBefore('<option>', { Value: "", text: "--- Select ---" });
                    $.each(data, function (index, value) {
                        $('#GroupID').append($('<option>',
                            {
                                value: value.Value,
                                text: value.Text
                            })).select2();
                    });
                    //$("#GroupID").val(order.Purpose).trigger('change');
                    //order.Purpose = "0";
                }
            });
            }
        })

        //for sgroupinfo load by GroupID.......
        $(document).on("change", "#GroupID", function (e) {
            $.ajax({
                url: '@Url.Action("LoadSGroupByGroupId", "Sales")',
                contentType: "application/json;charset=utf-8",
                data: {
                    ItemType: $("#ItemType").val(), GroupID: $("#GroupID").val()
                },
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#SGroupID').empty();
                    $.each(data, function (index, value) {
                        $('#SGroupID').append($('<option>',
                            {
                                value: value.Value,
                                text: value.Text
                            })).select2();
                    });
                }
            });
        })


        //for ssgroupinfo load by sGroupID.......
        $(document).on("change", "#SGroupID", function (e) {
            $.ajax({
                url: '@Url.Action("LoadSSGroupInfo", "Sales")',
                contentType: "application/json;charset=utf-8",
                data: {
                    ItemType: $("#ItemType").val(), GroupID: $("#GroupID").val(), SGroupID: $("#SGroupID").val()
                },
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#SSGroupID').empty();
                    $.each(data, function (index, value) {
                        $('#SSGroupID').append($('<option>',
                            {
                                value: value.Value,
                                text: value.Text
                            })).select2();
                    });
                }
            });
        })

        //for ItmeInfo load by ssGroupID....... ItemType, GroupId, SGroupId, SSGroupId
        $(document).on("click", "#closePopOver", function (e) {
            e.preventDefault();

            jQuery("#ItemType option").filter(function () {
                return $.trim($(this).text()) == '--- Select ---'
            }).prop('selected', true).trigger('change.select2');
            $('#Addmodal7').modal('hide');
            ClearComView();
        });

        $(document).on("click", "#btnOk", function (e) {
            $('#Addmodal7').modal('hide');
            $.ajax({
                url: '@Url.Action("LoadItemBySSGroupID", "Sales")',
                contentType: "application/json;charset=utf-8",
                data: {
                    ItemType: $("#ItemType").val(), GroupID: $("#GroupID").val(), SGroupID: $("#SGroupID").val(), SSGroupID: $("#SSGroupID").val()
                },
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#RecvItem').empty();
                    $.each(data, function (index, value) {
                        $('#RecvItem').append($('<option>',
                            {
                                value: value.Value,
                                text: value.Text
                            })).select2();
                    });
                    ClearComView();
                }
            });
        })

        function ClearComView() {
            var Stext = '---- Select ----';

            jQuery("#GroupID option").filter(function () {
                return $.trim($(this).text()) == Stext
            }).prop('selected', true).trigger('change.select2');

            jQuery("#SGroupID option").filter(function () {
                return $.trim($(this).text()) == Stext
            }).prop('selected', true).trigger('change.select2');

            jQuery("#SSGroupID option").filter(function () {
                return $.trim($(this).text()) == Stext
            }).prop('selected', true).trigger('change.select2');
        }

        $('#EAccode').select2();

        ///For RECEIVE*********************
        $("#FromLocCode").val($('#FromLocCode option:first-child').val()).trigger('change.select2');
        $("#ItemType").val($('#ItemType option:first-child').val()).trigger('change.select2');
        $("#RecvItem").val($('#RecvItem option:first-child').val()).trigger('change.select2');
        var table = $('#RecvInPaymentModalGV').dataTable({
            "paging": false,
            "ordering": false,
            "info": false,
            "searching": false,
            "scrollY": 200,
            "scrollX": true
        });
        $.ajax({
            url: '@Url.Action("GetRecvNo", "Receive")',
            contentType: "application/json;charset=utf-8",
            type: 'GET',
            dataType: 'json',
            success: function (datas) {
                $("#RcvNo").val(datas);
            }
        });
        $.ajax({
            url: '@Url.Action("GetVoucherNo", "Receive")',
            contentType: "application/json;charset=utf-8",
            data: { VType: 'IR', TrDate: $("#ExpenseDate").val() },
            type: 'GET',
            dataType: 'json',
            success: function (datas) {
                $("#VchrNo").val(datas);
            }
        });

        var isEdit = 0;
        var orders = [];
        $('#btnAddRecvInPay').click(function () {

            var FromLocCode = $("#FromLocCode").val();
            if(FromLocCode == "" || FromLocCode == " ")
            {
                alert("Store Location is required.");
                return;
            }
            var RecvItem = $("#RecvItem").val();
            if(RecvItem == "")
            {
                alert("Item is required.");
                return;
            }
            var Qty = $("#Qty").val();
            if(Qty<=0)
            {
                alert("Quantity is required.");
                return;
            }
            var Price = $("#Price").val();
            if(Price<=0)
            {
                alert("Unit Price is required.");
                return;
            }

            addOnRecvList();
            $("tbody#tbodyId tr:even").css({
                "background-color": "#e6e8e8"
            });
            clearRecvItemInfo();
        });
        function clearRecvItemInfo() {
            $("#Qty").val("");
            $("#Price").val("");
            $("#LotNo").val("");
        }

        function addOnRecvList() {
            var newAddList = [];
            var newAddListSl = 0;

            var RcvNo = $("#RcvNo").val();
            var ItemCode = $("#RecvItem option:selected").val();
            var CurrQty = $("#Qty").val();
            var Qty = $("#Qty").val();
            var ExQty = $("#Qty").val();
            var Description = $("#Description").val();
            var LotNo = "01";
            //if ($("#LotNo").val() != "") {
            //    LotNo = $("#LotNo").val();
            //}

            var Price = $("#Price").val();
            var UnitPrice = $("#Price").val();
            var ItemName = $('#RecvItem option:selected').text();
            var SubCode = $("#FromLocCode").val();

            if (Qty != "") {
                var item = {
                    ItemCode: ItemCode, CurrQty: CurrQty, LotNo: LotNo, SubCode: SubCode, Description:Description,
                    Price: Price, Sl: 0, ItemName: ItemName, RcvNo: RcvNo, ExQty: ExQty, Qty: Qty, UnitPrice:UnitPrice
                }

                const i = orders.findIndex(_item => _item.ItemCode === ItemCode && _item.LotNo === LotNo);
                if (i > -1)
                {
                    var prevQty = parseInt(orders[i].Qty);
                    CurrQty = prevQty + parseInt(CurrQty);
                    item.Qty = CurrQty;
                    item.CurrQty = CurrQty;
                    orders[i] = item;
                }
                else
                {
                    item.Sl = orders.length + 1;
                    orders.push(item);
                }
                addOnRecvTable();
            }
        }

        function addOnRecvTable() {
            $('#RecvInPaymentTbodyId').empty();
            var sl = 0;
            $.each(orders, function (index, data) {
                sl = sl + 1;
                data.Sl = sl;

                $("#RecvInPaymentTbodyId").append("<tr><td>" + sl + "</td><td>"
                                                   + data.ItemCode + "</td><td>"
                                                   + data.ItemName + "</td><td>"
                                                   + data.CurrQty + "</td><td style='text-align:right'>"
                                                   + data.Price + "</td><td style='text-align:right'>"
                                                   + data.Qty * data.Price + "</td><td>"
                                                   + '<a href="#" class="on-default remove-row deleteSup" data-id="' + sl + '" id="Recvdelete" value="' + sl + '"><i class="glyphicon glyphicon-trash"></i></a>' + "</td></tr>");

            });
        }


        $(document).on('click', '#Recvdelete', function () {
            var id = $(this).attr("value");
            swal({
                title: "Are you sure?",
                text: "You will not be able to recover this order data!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!",
                closeOnConfirm: true
            },
             function () {
                 deleteRecvRow(id);
                 addOnRecvTable();
                 swal("Deleted!", "Your imaginary file has been deleted.", "success");

             });
        });
        function deleteRecvRow(sl) {
            var newOrder = [];
            var newSl = 0;

            $.each(orders, function (index, data) {

                if (data.Sl != sl) {
                    newSl++;
                    data.Sl = newSl;
                    data.Id = 0;
                    newOrder.push(data);
                }
            });
            orders = new Array();
            orders = newOrder;

        }


        ///Ending For RECEIVE*********************

        $(document).on('click', '#addModalButton2', function () {
            if ('@ViewBag.CPReceive' == '') {
                $('#pnlReceive').hide();
            }
            $('#Addmodal2').modal('show');
            $('#saveExpense').show();
            $('#updateExpense').hide();
            $("#saveExWithReceive").hide();
            $("#saveExWithSub").hide();
            $.ajax({
                url: '@Url.Action("GetExpenseNo", "Expense")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#ExpenseNo").val(datas);
                }
            });

            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "Expense")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'CP' },// TrDate: $("#TrDate").val()
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#eVoucherNo").val(datas);
                }
            });

            $(document).on("click", "#newVchr", function () {
                $("#addModalButton").show();
                $.ajax({
                    url: '@Url.Action("GetNewVoucherNo", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: { VType: 'CP' },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas != 0) {
                            $("#eVoucherNo").val(datas);
                        }
                    }
                })
            });
        });

        $(document).on("change", "#EAccode", function () {
            var order = { purAccode: "" };

            $.ajax({
                url: '@Url.Action("ChechSubStock", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: {
                    purAccode: $("#EAccode").val()
                },
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    if (data == 2) {
                        $('#saveExpense').hide();
                        $('#updateExpense').hide();
                        $("#saveExWithReceive").hide();
                        $("#saveExWithSub").show();
                        $('#Addmodal6').modal('show');
                        $.ajax({
                            url: '@Url.Action("GetSubsidiaryByPurpose", "CashOperation")',
                            contentType: "application/json;charset=utf-8",
                            data: {
                                purAccode: $("#EAccode").val()
                            },
                            type: 'GET',
                            dataType: 'json',
                            success: function (data) {
                                $('#SubsidiaryCode').empty();
                                $.each(data, function (index, value) {
                                    $('#SubsidiaryCode').append($('<option>',
                                        {
                                            value: value.Value,
                                            text: value.Text
                                        })).select2();
                                });
                                $("#SubsidiaryCode").val(orders.SubsidiaryCode).trigger('change');
                                orders.SubsidiaryCode = "0";
                            }
                        });
                    }
                    else {

                    }

                }
            });
        });




        $(document).on("change", "#RcvItemCode", function (e) {

            $.ajax({
                type: "Get",
                contentType: "application/json;charset=utf-8",
                url: '@Url.Action("GetItemByQtyPrice", "CashOperation")',
                data: { Item: $("#RcvItemCode").val() },
                dataType: 'json',
                success: function (item) {
                    if (item == 0) {
                        alert("Data Not Found");
                        clearItemInfo();
                    }
                    else {
                        $("#RcvItemExQty").val(item.CurrQty);
                        //$("#RcvItemPrice").val(item.UnitPrice);
                        $("#RcvItemLotNo").val(item.LotNo);
                    }
                }
            });

        });

        var rcvOrders = [];
        $('#addRcvItem').click(function () {
            addOnRcvList();
            clearRcvItemInfo();

        });
        function clearRcvItemInfo() {
            $("#RcvItemExQty").val("");
            $("#RcvItemQty").val("");
            $("#RcvItemPrice").val("");
            $("#RcvItemLotNo").val("");
            $("#RcvDescription").val("");
        }

        function addOnRcvList() {
            var newAddList = [];
            var newAddListSl = 0;

            var RcvNo = $("#ReceiveNo").val();
            var ItemCode = $("#RcvItemCode option:selected").val();
            var Description = $("#RcvDescription").val();
            var Qty = $("#RcvItemQty").val();
            var BadQty = $("#BadQty").val();
            var LotNo = $("#RcvItemLotNo").val();
            var Price = $("#RcvItemPrice").val();
            var ExQty = $("#RcvItemExQty").val();
            var ItemName = $('#RcvItemCode option:selected').text();

            if (Qty != "") {
                var item = {
                    ItemCode: ItemCode, Description: Description, Qty: Qty, BadQty: BadQty, LotNo: LotNo,
                    Price: Price, ExQty: ExQty, Sl: 0, ItemName: ItemName, RcvNo: RcvNo
                }
                item.Sl = rcvOrders.length + 1
                rcvOrders.push(item);
                addOnRcvTable();
            }
            else {
                swal(
                     'Sorry!',
                     'Something went wrong please try again!',
                     'warning'
                 );

            }
        }
        $(document).on('click', '#deleteTmpRcvItem', function () {
            var id = $(this).attr("value");

            swal({
                title: "Are you sure?",
                text: "You will not be able to recover this order data!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!",
                closeOnConfirm: true
            },
             function () {
                 deleteRcvRow(id);
                 addOnRcvTable();
                 swal("Deleted!", "Your imaginary file has been deleted.", "success");

             });
        });
        function deleteRcvRow(sl) {
            var newOrder = [];
            var newSl = 0;

            $.each(rcvOrders, function (index, data) {

                if (data.Sl != sl) {
                    newSl++;
                    data.Sl = newSl;
                    data.Id = 0;
                    newOrder.push(data);
                }
            });
            rcvOrders = new Array();
            rcvOrders = newOrder;

        }

        function addOnRcvTable() {

            $('#tbodyId3').empty();
            var sl = 0;
            var amount = 0.0;
            $.each(rcvOrders, function (index, data) {
                sl = sl + 1;
                data.Sl = sl;
                $("#tbodyId3").append("<tr><td>" + sl + "</td><td>"
                    + data.ItemName + "</td><td>"
                    + data.Qty + "</td><td>"
                    + data.BadQty + "</td><td>"
                    + data.Qty * data.Price + "</td><td>"
                    + data.LotNo + "</td><td>"
                    + '<a href="#" class="on-default remove-row deleteSup" data-id="' + sl + '" id="deleteTmpRcvItem" value="' + sl + '"><i class="glyphicon glyphicon-trash"></i></a>' + "</td></tr>");
                amount += (data.Qty * data.Price);
            });
            $("#EAmount").val(amount);

        }


        $(document).on("click", "#saveReceive", function () {


            $('#Addmodal5').modal('hide');

        });

        $(document).on("click", "#closeReceive", function () {

            $('#Addmodal5').modal('hide');

        });

        $(document).on("click", "#saveExWithReceive", function () {

            $("#saveExWithReceive").prop("disabled", false);
            var expenses = { ExpenseNo: "", ExpenseDate: "", VoucherNo: "", expPurAccode: "", Amount: "", Advance: false, Remarks: "" };

            expenses.ExpenseNo = $("#ExpenseNo").val();
            expenses.ExpenseDate = $("#ExpenseDate").val();
            expenses.VoucherNo = $("#eVoucherNo").val();
            expenses.Amount = parseFloat($("#EAmount").val()).toFixed(2).replace(".", ",");  
            expenses.expPurAccode = $("#EAccode").val();
            expenses.Advance = $("#EAdvance").prop("checked");
            expenses.Remarks = $("#Remarks1").val();

            var recvInfo = {
                RcvNo: "", FromLocCode: "", ToLocCode: "", Source: "", RefNo: "", Accode: "", Item: "", Description: "",
                Qty: "", ExQty: "", Price: "", LotNo: "", RcvDate: "", RefDate: "", ReceiveFrom: "", Remarks: "",
                RcvdByCode: "", AppByCode: "", RcvdDate: "", RcvdTime: ""
            };

            recvInfo.RcvNo = $("#ReceiveNo").val();
            recvInfo.RcvDate = $("#ReceiveDate").val();
            recvInfo.FromLocCode = $("#RcvFromLocCode").val();
            recvInfo.ToLocCode = $("#ReceiveFromSubCode").val();
            recvInfo.Source = $("#SourceCode").val();
            recvInfo.RefNo = $("#RcvRefNo").val();
            recvInfo.Accode = $("#RcvPurAccode").val();

            recvInfo.RefDate = $("#RcvRefDate").val();

            recvInfo.Remarks = $("#RcvRemarks").val();
            recvInfo.RcvdByCode = $("#ReceiveByCode").val();
            recvInfo.AppByCode = $("#RcvAppByCode").val();
            recvInfo.RcvdDate = $("#RcvDate").val();
            recvInfo.RcvdTime = $("#RcvTime").val();

            if (parseFloat(expenses.Amount) <= 0 || !expenses.Amount.trim()) {
                alert("Amount is Required");
            }

            else {
                $.ajax({
                    url: '@Url.Action("SaveExWithReceive", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ expense: expenses, recvInfo: recvInfo, recvDetails: rcvOrders }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveExpense").prop("disabled", false);
                            clearExpenseForm();

                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveExpense").prop("disabled", false);
                        }
                        else if (datas == 1) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveExpense").prop("disabled", false);
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("GetNewVoucherNo", "Expense")',
                                    contentType: "application/json;charset=utf-8",
                                    data: { VType: 'CP', TrDate: $("#TrDate").val() },
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#eVoucherNo").val(datas);
                                    }
                                });
                            });
                            $("#saveExpense").prop("disabled", false);
                            AddOnExpenseAndDeposit(datas);
                            clearExpenseForm();
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveExpense").prop("disabled", true);
                    }
                });
            }

        });

        $(document).on("click", "#saveExWithSub", function () {

            $("#saveExWithSub").prop("disabled", false);
            var expenses = { ExpenseNo: "", ExpenseDate: "", VoucherNo: "",RefNo:"", expPurAccode: "", Amount: "", Advance: false, Remarks: "" };

            expenses.ExpenseNo = $("#ExpenseNo").val();
            expenses.ExpenseDate = $("#ExpenseDate").val();
            expenses.VoucherNo = $("#eVoucherNo").val();
            expenses.RefNo = $("#PayRefNo").val();
            expenses.Amount = parseFloat($("#EAmount").val()).toFixed(2).replace(".", ",");  
            expenses.expPurAccode = $("#EAccode").val();
            expenses.Advance = $("#EAdvance").prop("checked");
            expenses.Remarks = $("#Remarks1").val();
            if (parseFloat(expenses.Amount) <= 0 || !expenses.Amount.trim()) {
                alert("Amount is Required");
            }

            else {
                $.ajax({
                    url: '@Url.Action("SaveExWithSubsidiary", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ expense: expenses, expDetails: subOrders }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveExWithSub").prop("disabled", false);
                            clearExpenseForm();

                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveExWithSub").prop("disabled", false);
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            });
                            $("#saveExpense").prop("disabled", false);
                            AddOnExpenseAndDeposit(datas);
                            clearExpenseForm();
                            $("#tbodyId4").empty();
                            subOrders = [];
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveExpense").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#UpdateExWithSub", function () {

            $("#UpdateExWithSub").prop("disabled", false);
            var expenses = { ExpenseNo: "", ExpenseDate: "", VoucherNo: "",RefNo:"", expPurAccode: "", Amount: "", Advance: false, Remarks: "" };

            expenses.ExpenseNo = $("#ExpenseNo").val();
            expenses.ExpenseDate = $("#ExpenseDate").val();
            expenses.VoucherNo = $("#eVoucherNo").val();
            expenses.RefNo = $("#PayRefNo").val();
            expenses.Amount = parseFloat($("#EAmount").val()).toFixed(2).replace(".", ",");  
            expenses.expPurAccode = $("#EAccode").val();
            expenses.Advance = $("#EAdvance").prop("checked");
            expenses.Remarks = $("#Remarks1").val();
            if (parseFloat(expenses.Amount) <= 0 || !expenses.Amount.trim()) {
                alert("Amount is Required");
            }

            else {
                $.ajax({
                    url: '@Url.Action("UpdateExWithSubsidiary", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ expense: expenses, expDetails: subOrders }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveExWithSub").prop("disabled", false);
                            clearExpenseForm();

                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveExWithSub").prop("disabled", false);
                        }
                        else if (datas == "U") {
                            swal({
                                title: "Sorry",
                                text: "No Update Permission for this User",
                                type: "warning"
                            });
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Update Sucessfully!",
                                type: "success"
                            });
                            $("#saveExpense").prop("disabled", false);
                            AddOnExpenseAndDeposit(datas);
                            clearExpenseForm();
                            $("#tbodyId4").empty();
                            subOrders = [];
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveExpense").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#saveExpense", function () {

            $("#saveExpense").prop("disabled", false);

            var recvInfo = { EAccode: "", RcvNo: "", VchrNo: "", FromLocCode: "", RcvDate: ""};
            recvInfo.EAccode = $("#EAccode").val();
            recvInfo.RcvNo = $("#RcvNo").val();
            recvInfo.VchrNo = $("#VchrNo").val();
            recvInfo.StoreLocCode = $("#FromLocCode").val();
            recvInfo.RcvDate = $("#ExpenseDate").val();

            var expenses = { ExpenseNo: "", ExpenseDate: "", VoucherNo: "",RefNo:"", expPurAccode: "", 
                Amount: "", Advance: false, Remarks: "", JobNo: "" };

            expenses.ExpenseNo = $("#ExpenseNo").val();
            expenses.ExpenseDate = $("#ExpenseDate").val();
            expenses.VoucherNo = $("#eVoucherNo").val();
            expenses.RefNo = $("#PayRefNo").val();
            expenses.JobNo = $("#expJobNo").val();
            expenses.Amount = parseFloat($("#EAmount").val()).toFixed(2).replace(".", ",");  
            expenses.expPurAccode = $("#EAccode").val();
            expenses.Advance = $("#EAdvance").prop("checked");
            expenses.Remarks = $("#Remarks1").val();
            if (parseFloat(expenses.Amount) <= 0 || !expenses.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("SaveExpense", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ expense: expenses , recvInfo:recvInfo, recvDetails: orders, currentStock: orders}),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveExpense").prop("disabled", false);
                            clearExpenseForm();

                        }
                        else if (datas == "X") {
                            swal({
                                title: "Sorry",
                                text: "No Save Permission for this User",
                                type: "warning"
                            });
                        }
                        else if (datas == 1) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#saveExWithSub").prop("disabled", false);
                        }
                        else if (datas == 3) {
                            swal({
                                title: "Save Failed!!!",
                                text: "Already exists Please try again!",
                                type: "warning"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("ExpenseNoIncreement", "Expense")',
                                    contentType: "application/json;charset=utf-8",
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#ExpenseNo").val(datas);
                                    }
                                });
                            });
                            $("#save").prop("disabled", false);
                        }
                        else if (datas.data == 4) {
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("GetNewVoucherNo", "Expense")',
                                    contentType: "application/json;charset=utf-8",
                                    data: { VType: 'CP', TrDate: $("#TrDate").val() },
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#eVoucherNo").val(datas);
                                    }
                                });
                            });
                            $("#saveExpense").prop("disabled", false);
                            AddOnExpenseAndDeposit(datas.CashOPVM);
                            clearExpenseForm();
                        }
                        else{
                            swal(
                                'Sorry!',
                                datas,
                                'warning'
                            );
                        }
                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveExpense").prop("disabled", true);
                    }
                });
            }

        });

        $(document).on("click", "#updateExpense", function () {

            $("#updateExpense").prop("disabled", false);
            var expenses = { ExpenseNo: "", ExpenseDate: "", VoucherNo: "",RefNo:"", expPurAccode: "", Amount: "", Advance: false, Remarks: "", JobNo:"" };
            var date = $("#ExpenseDate").val();


            var recvInfo = { EAccode: "", RcvNo: "", VchrNo: "", FromLocCode: "", RcvDate: ""};
            recvInfo.EAccode = $("#EAccode").val();
            recvInfo.RcvNo = $("#RcvNo").val();
            recvInfo.VchrNo = $("#VchrNo").val();
            recvInfo.StoreLocCode = $("#FromLocCode").val();
            recvInfo.RcvDate = $("#ExpenseDate").val();

            expenses.ExpenseNo = $("#ExpenseNo").val();
            expenses.ExpenseDate = $("#ExpenseDate").val();
            expenses.VoucherNo = $("#eVoucherNo").val();
            expenses.RefNo = $("#PayRefNo").val();
            expenses.Amount = parseFloat($("#EAmount").val()).toFixed(2).replace(".", ",");  
            expenses.expPurAccode = $("#EAccode").val();
            expenses.JobNo = $("#expJobNo").val();
            expenses.Advance = $("#EAdvance").prop("checked");
            expenses.Remarks = $("#Remarks1").val();
            if (parseFloat(expenses.Amount) <= 0 || !expenses.Amount.trim()) {
                alert("Amount is Required");
            }

            else {
                $.ajax({
                    url: '@Url.Action("UpdateExpense", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ expense: expenses, dateTime: $("#ExpenseDate").val() , recvInfo:recvInfo, recvDetails: orders, currentStock: orders}),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Sorry!',
                                'Cash is already closed. You are not allowed to update any data!!!',
                                'warning'
                            );
                            clearExpenseForm();
                        }
                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#updateExpense").prop("disabled", false);
                        }
                        else if (datas == "U") {
                            swal({
                                title: "Sorry",
                                text: "No Update Permission for this User",
                                type: "warning"
                            });
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Update Sucessfully!",
                                type: "success"
                            });
                            $("#updateExpense").prop("disabled", false);
                            AddOnExpenseAndDeposit(datas);
                            clearExpenseForm();

                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#updateExpense").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#closeExpense", function () {
            $('#Addmodal2').modal('hide');
            //location.reload();
            $.ajax({
                url: '@Url.Action("GetGlECount", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'COP' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#lblProvB").html('('+datas+')');
                }
            });
        });

        $(document).on("click", "#clearExpense", function () {
            clearExpenseForm();
        });

        function clearExpenseForm() {

            $("#ExpenseNo").val("");
            $("#eVoucherNo").val("");
            $("#PayRefNo").val("");
            $("#EAmount").val("");
            $("#EAccode").val($('#EAccode option:first-child').val()).trigger('change.select2');
            $("#EAdvance").prop("checked", false);
            $("#Remarks1").val("");

            $('#saveExpense').show();
            $('#updateExpense').hide();
            $('#saveExWithSub').hide();
            $('#UpdateExWithSub').hide();

            $.ajax({
                url: '@Url.Action("GetExpenseNo", "Expense")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#ExpenseNo").val(datas);
                }
            });

            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "Expense")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'CP' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#eVoucherNo").val(datas);
                }
            });

            //For Payment Receive

            $.ajax({
                url: '@Url.Action("GetRecvNo", "Receive")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#RcvNo").val(datas);
                }
            });
            $.ajax({
                url: '@Url.Action("GetVoucherNo", "Receive")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'IR', TrDate: $("#ExpenseDate").val() },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#VchrNo").val(datas);
                }
            });
            $("#FromLocCode").val($('#FromLocCode option:first-child').val()).trigger('change.select2');
            $("#RecvItem").val($('#RecvItem option:first-child').val()).trigger('change.select2');
            $("#ItemType").val($('#ItemType option:first-child').val()).trigger('change.select2');
            $("#Qty").val("");
            $("#Price").val("");
            $("#Description").val("");
            $('#RecvInPaymentTbodyId').empty();
            orders = new Array();
        }

        /////*************************Deposit To Bank****************************//////

        $('#DAccode').select2();

        $(document).on('click', '#addModalButton3', function () {
            $('#Addmodal3').modal('show');
            $('#saveDTB').show();
            $('#updateDTB').hide();
            $('#DAccode').select2();
            $.ajax({
                url: '@Url.Action("GetDepositNo", "DepositToBank")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#DepositNo").val(datas);
                }
            });
            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "DepositToBank")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'BD', TrDate: $("#TrDate").val() },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#dVoucherNo").val(datas);
                }
            });

            $(document).on("click", "#newVchr", function () {
                $("#addModalButton").show();
                $.ajax({
                    url: '@Url.Action("GetNewVoucherNo", "DepositToBank")',
                    contentType: "application/json;charset=utf-8",
                    data: { VType: 'BD' },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas != 0) {
                            $("#dVoucherNo").val(datas);
                        }
                    }
                })
            });
        });

        $(document).on("click", "#saveDTB", function () {

            var depositToBank = { DepositNo: "", DepositDate: "", VoucherNo: "", bankAccode: "", Amount: "", DSlipNo: "" };
            $("#saveDTB").prop("disabled", false);
            depositToBank.DepositNo = $("#DepositNo").val();
            depositToBank.DepositDate = $("#DepositDate").val();
            depositToBank.VoucherNo = $("#dVoucherNo").val();
            depositToBank.bankAccode = $("#DAccode").val();
            depositToBank.Amount = parseFloat($("#DAmount").val()).toFixed(2).replace(".", ","); 
            depositToBank.DSlipNo = $("#DSlipNo").val();
            if (parseFloat(depositToBank.Amount) <= 0 || !depositToBank.Amount.trim()) {
                alert("Amount is Required");
            }
            else {
                $.ajax({
                    url: '@Url.Action("SaveDepositToBank", "DepositToBank")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ deposit: depositToBank }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Save Failed!!!',
                                'Cash is already closed. You cannot save data!!!',
                                'warning'
                            );
                            $("#saveDTB").prop("disabled", false);
                            clearDepositToBank();

                        }
                        else if (datas == "X") {
                            swal({
                                title: "Sorry",
                                text: "No Save Permission for this User",
                                type: "warning"
                            });
                        }
                        else if (datas == 3) {
                            swal({
                                title: "Save Failed!!!",
                                text: "Already exists Please try again!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("DepositNoIncreement", "DepositToBank")',
                                    contentType: "application/json;charset=utf-8",
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#DepositNo").val(datas);
                                    }
                                });
                            });
                            $("#save").prop("disabled", false);
                        }
                        else if (datas == 1) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#save").prop("disabled", false);
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Save Sucessfully!",
                                type: "success"
                            }, function () {
                                $.ajax({
                                    url: '@Url.Action("GetNewVoucherNo", "DepositToBank")',
                                    contentType: "application/json;charset=utf-8",
                                    data: { VType: 'BD', TrDate: $("#TrDate").val() },
                                    type: 'GET',
                                    dataType: 'json',
                                    success: function (datas) {
                                        $("#dVoucherNo").val(datas);
                                    }
                                });
                            });
                            $("#saveDTB").prop("disabled", false);
                            AddOnExpenseAndDeposit(datas);
                            clearDepositToBank();
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#saveDTB").prop("disabled", true);
                    }
                });
            }

        });


        $(document).on("click", "#updateDTB", function () {

            $("#updateDTB").prop("disabled", false);

            var depositToBank = { DepositNo: "", DepositDate: "", VoucherNo: "", bankAccode: "", Amount: "", DSlipNo: "" };
            var date = $("#DepositDate").val();

            depositToBank.DepositNo = $("#DepositNo").val();
            depositToBank.DepositDate = $("#DepositDate").val();
            depositToBank.VoucherNo = $("#dVoucherNo").val();
            depositToBank.bankAccode = $("#DAccode").val();
            depositToBank.Amount = parseFloat($("#DAmount").val()).toFixed(2).replace(".", ","); 
            depositToBank.DSlipNo = $("#DSlipNo").val();

            if (parseFloat(depositToBank.Amount) <= 0 || !depositToBank.Amount.trim()) {
                alert("Amount is Required");
            }

            else {
                $.ajax({
                    url: '@Url.Action("UpdateDepositToBank", "DepositToBank")',
                    contentType: "application/json;charset=utf-8",
                    data: JSON.stringify({ deposit: depositToBank, dateTime: $("#DepositDate").val() }),
                    type: 'POST',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            swal(
                                'Sorry!',
                                'Cash is already closed. You are not allowed to update any data!!!',
                                'warning'
                            );
                            clearDepositToBank();
                        }

                        else if (datas == 0) {
                            swal(
                                'Sorry!',
                                'Something went wrong please try again!',
                                'warning'
                            );
                            $("#updateDTB").prop("disabled", false);
                        }
                        else if (datas == "U") {
                            swal({
                                title: "Sorry",
                                text: "No Update Permission for this User",
                                type: "warning"
                            });
                        }
                        else {
                            swal({
                                title: "Ok",
                                text: "Update Sucessfully!",
                                type: "success"
                            });
                            AddOnExpenseAndDeposit(datas);
                            clearDepositToBank();
                        }

                    },
                    error: function (datas) {
                        swal("There is network connection error! or Critical system error (Try again!)", "warning")
                        $("#updateDTB").prop("disabled", true);
                    }
                });
            }

        });



        $(document).on("click", "#closeDTB", function () {
            $('#Addmodal3').modal('hide');
            //location.reload();
            $.ajax({
                url: '@Url.Action("GetGlECount", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'COP' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#lblProvB").html('('+datas+')');
                }
            });
        });

        $(document).on("click", "#clearDTB", function () {
            clearDepositToBank();
        });


        function clearDepositToBank() {
            $("#DepositNo").val("");
            //$("#DAccode").val("").trigger('change.select2');
            $('#DAccode').val($('#DAccode option:first-child').val()).trigger('change.select2');
            $("#DAmount").val("");
            $("#dVoucherNo").val("");
            $("#DSlipNo").val("");
            $('#saveDTB').show();
            $('#updateDTB').hide();
            $.ajax({
                url: '@Url.Action("GetDepositNo", "DepositToBank")',
                contentType: "application/json;charset=utf-8",
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#DepositNo").val(datas);
                }
            });

            $.ajax({
                url: '@Url.Action("GetNewVoucherNo", "DepositToBank")',
                contentType: "application/json;charset=utf-8",
                data: { VType: 'BD' },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    $("#dVoucherNo").val(datas);
                }
            });

        }

        /////////*****************************************************//////////


        $(document).on("click", "#print", function () {
            alert("Not Implement Yet");
        });

        var subOrders = [];


        $(document).on("click", "#delete", function () {
            var tag = $(this).attr("tag");
            var value = $(this).attr("value");
            var trDate = moment($('#TrDate').val(), 'DD/MM/YYYY').format('MM/DD/YYYY').toString();
            $.ajax({
                url: '@Url.Action("DeleteVoucherPro", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: { remitNo: value, tag: tag },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    if (datas == 0) {
                        swal(
                            'Sorry!',
                            'This Voucher already Posted !!',
                             'warning'
                             );
                    }
                    else {
                        swal({
                            title: "Are you sure?",
                            text: "You will not be able to recover this order data!",
                            type: "warning",
                            showCancelButton: true,
                            confirmButtonColor: "#DD6B55",
                            confirmButtonText: "Yes, delete it!",
                            closeOnConfirm: true,
                            closeOnCancel: true
                        },
                 function () {
                     $.ajax({
                         url: '@Url.Action("DelCashOperation", "CashOperation")',
                         contentType: "application/json;charset=utf-8",
                         data: { tag: tag, transactionNo: value, dateTime: trDate },
                         type: 'GET',
                         dataType: 'json',
                         success: function (datas) {

                             if (datas == 0 && datas.length != 0) {
                                 swal("Sorry!! Failed to delete this order data.", "fail");
                             }
                             else if (datas == 1) {

                                 swal(
                                    'Sorry!',
                                    'Cash is already closed. You are not allowed to delete this data!!!',
                                    'warning'
                                );
                             }
                             else if (datas == "D") {
                                 swal({
                                     title: "Sorry",
                                     text: "No Delete Permission for this User",
                                     type: "warning"
                                 });
                             }
                             else {
                                 swal({
                                     title: "Ok",
                                     text: "Delete Sucessfully!",
                                     type: "success"
                                 }, function () {
                                     if (tag == "CR" || tag == "BW") {
                                         $("#tbodyId").empty();
                                         AddOnCashReceiptAndWithdraw(datas);
                                         swal.close()
                                         location.reload();
                                     }
                                     else {

                                         $("#tbodyId1").empty();
                                         AddOnExpenseAndDeposit(datas);
                                         swal.close()
                                         location.reload();
                                     }
                                 });

                             }

                         },
                         error: function (datas) {
                             swal("Sorry!! Failed to delete this order data.", "fail")
                         }
                     });
                 });
                    }

                }
            });
        });

        $(document).on("click", "#edit", function () {
            var tag = $(this).attr("tag");
            var value = $(this).attr("value");

            if (tag == "CR") {

                $.ajax({
                    url: '@Url.Action("GetCashReceipt", "CashReceipt")',
                    contentType: "application/json;charset=utf-8",
                    data: { receiptNo: value },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            $("#saveCashReceipt").hide();
                            $("#saveCRWithIssue").hide();
                            $("#saveCRWithSub").hide();
                            $("#UpdateCashReceipt").show();

                            $.ajax({
                                url: '@Url.Action("GetCashReceiptBYReceiptNo", "CashReceipt")',
                                contentType: "application/json;charset=utf-8",
                                data: { receiptNo: value },
                                type: 'GET',
                                dataType: 'json',
                                success: function (datas) {
                                    if (datas != 0) {
                                        $('#Addmodal').modal('show');
                                        $("#ReceiptNo").val(datas.ReceiptNo);
                                        $("#ReceiptDate").val();
                                        $("#purAccode").val(datas.purAccode).trigger('change.select2');
                                        $("#JobNo").val(datas.JobNo).trigger('change.select2');
                                        $("#VoucherNo").val(datas.VoucherNo);
                                        $("#RefNo").val(datas.RefNo);
                                        $("#Amount").val(datas.Amount);
                                        $("#Advance").prop("checked", datas.Advance);
                                        $("#Remarks").val(datas.Remarks);
                                    }

                                    else {
                                        swal(
                                             'Sorry!',
                                             'This Voucher already Posted !!',
                                            'warning'
                                             );
                                    }
                                }
                            });
                        }

                        else if (datas == 1) {
                            $("#saveCashReceipt").hide();
                            $("#saveCRWithIssue").hide();
                            $("#saveCRWithSub").hide();
                            $("#UpdateCashReceipt").hide();
                            $("#UpdateCRWithSub").show();
                            $('#Addmodal6').modal('show');

                            $.ajax({
                                url: '@Url.Action("GetAllByReceiptNo", "CashReceipt")',
                                contentType: "application/json;charset=utf-8",
                                data: { receiptNo: value },
                                type: 'GET',
                                dataType: 'json',
                                success: function (datas) {

                                    datas = $.parseJSON(datas);

                                    if (datas != 0) {
                                        $('#Addmodal').modal('show');
                                        $("#ReceiptNo").val(datas.Main.ReceiptNo);
                                        $("#ReceiptDate").val();
                                        $("#purAccode").val(datas.Main.purAccode).trigger('change.select2');
                                        $("#JobNo").val(datas.Main.JobNo).trigger('change.select2');
                                        $("#VoucherNo").val(datas.Main.VoucherNo);
                                        $("#RefNo").val(datas.Main.RefNo);
                                        $("#Amount").val(datas.Main.Amount);
                                        $("#Advance").prop("checked", datas.Main.Advance);
                                        $("#Remarks").val(datas.Main.Remarks);
                                        subOrders = [];
                                        if (datas.Details.length > 0) {
                                            var j = 0;
                                            $.each(datas.Details, function (index, data) {
                                                j++;
                                                data.Sl = j;
                                                subOrders.push(data);

                                            });

                                            addOnSubTable();

                                            $.ajax({
                                                url: '@Url.Action("GetSubsidiaryByPurpose", "CashOperation")',
                                                contentType: "application/json;charset=utf-8",
                                                data: { purAccode: datas.Main.purAccode },
                                                type: 'GET',
                                                dataType: 'json',
                                                success: function (datas) {
                                                    if (datas != 0) {

                                                        $('#SubsidiaryCode').empty();
                                                        $.each(datas, function (index, value) {
                                                            $('#SubsidiaryCode').append($('<option>',
                                                                {
                                                                    value: value.Value,
                                                                    text: value.Text
                                                                })).select2();
                                                        });
                                                        $("#SubsidiaryCode").val(orders.SubsidiaryCode).trigger('change');
                                                        orders.SubsidiaryCode = "0";

                                                    }
                                                }


                                            });
                                        }
                                    }
                                    else {
                                        $('#Addmodal6').modal('hide');
                                        swal(
                                            'Sorry!',
                                            'This Voucher already Posted !!',
                                            'warning'
                                               );
                                    }
                                }
                                ,
                                error: function (jqXHR, textStatus, errorThrown) {
                                    alert(errorThrown);
                                }
                            });
                        }
                    }
                });

            }
            else if (tag == "BW") {
                $("#UpdateWithdraw").show();
                $("#saveWithdraw").hide();
                $.ajax({
                    url: '@Url.Action("GetWithdrawBYWithdrawNo", "Withdraw")',
                    contentType: "application/json;charset=utf-8",
                    data: { withdrawNo: value },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas != 0) {
                            $('#Addmodal1').modal('show');
                            if (DateInDMYformat(datas.WithdrawDate) != moment('01/01/1900').format('DD/MM/YYYY')) {
                                $("#WithdrawDate").datepicker("setDate", DateInDMYformat(datas.WithdrawDate));
                            }
                            //$("#WithdrawDate").val();
                            $("#withdrawNo").val(datas.WithdrawNo);
                            $("#wChequeNo").val(datas.ChequeNo);
                            $("#wVoucherNo").val(datas.VoucherNo);
                            $("#wAmount").val(datas.Amount);
                            $("#WAccode").val(datas.bankAccode).trigger('change.select2');

                        }

                        else {
                            swal(
                                 'Sorry!',
                                 'This Voucher already Posted !!',
                                'warning'
                                 );
                        }

                    }
                });
            }
            else if (tag == "CP") {

                $.ajax({
                    url: '@Url.Action("GetExpense", "Expense")',
                    contentType: "application/json;charset=utf-8",
                    data: { receiptNo: value },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas == 2) {
                            $("#saveExpense").hide();
                            $("#saveExWithReceive").hide();
                            $("#saveExWithSub").hide();
                            $("#updateExpense").show();
                            $("#UpdateExWithSub").hide();

                            $.ajax({
                                url: '@Url.Action("GetExpenseBYExpenseNo", "Expense")',
                                contentType: "application/json;charset=utf-8",
                                data: { expenseNo: value },
                                type: 'GET',
                                dataType: 'json',
                                success: function (datas) {
                                    if (datas != 0) {
                                        if ('@ViewBag.CPReceive' == '') {
                                            $('#pnlReceive').hide();
                                        }
                                        $('#Addmodal2').modal('show');
                                        $("#ExpenseNo").val(datas.expense.ExpenseNo);
                                        $("#ExpenseDate").val();
                                        $("#eVoucherNo").val(datas.expense.VoucherNo);
                                        $("#PayRefNo").val(datas.expense.RefNo);
                                        $("#EAmount").val(datas.expense.Amount);
                                        $("#EAccode").val(datas.expense.expPurAccode).trigger('change.select2');
                                        $("#expJobNo").val(datas.expense.JobNo).trigger('change.select2');
                                        $("#EAdvance").prop("checked", datas.expense.Advance);
                                        $("#Remarks1").val(datas.expense.Remarks);

                                        $("#RcvNo").val(datas.recvInfo.Main.RcvNo);
                                        $("#VchrNo").val(datas.recvInfo.Main.VchrNo);
                                        $("#FromLocCode").val(datas.recvInfo.Main.StoreLocCode).trigger('change.select2');
                                        orders = [];
                                        if (datas.recvInfo.Details.length > 0) {
                                            var j = 0;
                                            $.each(datas.recvInfo.Details, function (index, data) {
                                                j++;
                                                data.Sl = j;
                                                orders.push(data);

                                            });
                                            isEdit = 1;
                                            addOnRecvTable();
                                        }

                                    }
                                    else {
                                        $('#Addmodal6').modal('hide');
                                        swal(
                                            'Sorry!',
                                            'This Voucher already Posted !!',
                                           'warning'
                                            );
                                    }

                                }
                            });
                        }

                        else if (datas == 1) {
                            $("#saveExpense").hide();
                            $("#saveExWithReceive").hide();
                            $("#saveExWithSub").hide();
                            $("#updateExpense").hide();
                            $("#UpdateExWithSub").show();
                            // $('#Addmodal').modal('show');
                            $('#Addmodal6').modal('show');
                            $.ajax({
                                url: '@Url.Action("GetAllByExpenseNo", "Expense")',
                                contentType: "application/json;charset=utf-8",
                                data: { expenseNo: value },
                                type: 'GET',
                                dataType: 'json',
                                success: function (datas) {

                                    datas = $.parseJSON(datas);

                                    if (datas != 0) {
                                        if ('@ViewBag.CPReceive' == '') {
                                            $('#pnlReceive').hide();
                                        }
                                        $('#Addmodal2').modal('show');
                                        $("#ExpenseNo").val(datas.Main.ExpenseNo);
                                        $("#ExpenseDate").val();
                                        $("#PayRefNo").val(datas.Main.RefNo);
                                        $("#eVoucherNo").val(datas.Main.VoucherNo);
                                        $("#EAmount").val(datas.Main.Amount);
                                        $("#EAccode").val(datas.Main.expPurAccode).trigger('change.select2');
                                        $("#expJobNo").val(datas.Main.JobNo).trigger('change.select2');
                                        $("#EAdvance").prop("checked", datas.Main.Advance);
                                        $("#Remarks1").val(datas.Main.Remarks);
                                        subOrders = [];
                                        if (datas.Details.length > 0) {
                                            var j = 0;
                                            $.each(datas.Details, function (index, data) {
                                                j++;
                                                data.Sl = j;
                                                subOrders.push(data);

                                            });

                                            addOnSubTable();

                                            $.ajax({
                                                url: '@Url.Action("GetSubsidiaryByPurpose", "CashOperation")',
                                                contentType: "application/json;charset=utf-8",
                                                data: { purAccode: datas.Main.expPurAccode },
                                                type: 'GET',
                                                dataType: 'json',
                                                success: function (datas) {

                                                    if (datas != 0) {

                                                        $('#SubsidiaryCode').empty();
                                                        $.each(datas, function (index, value) {
                                                            $('#SubsidiaryCode').append($('<option>',
                                                                {
                                                                    value: value.Value,
                                                                    text: value.Text
                                                                })).select2();
                                                        });
                                                        $("#SubsidiaryCode").val(orders.SubsidiaryCode).trigger('change');
                                                        orders.SubsidiaryCode = "0";

                                                    }
                                                }


                                            });




                                        }
                                    }
                                    else {
                                        swal(
                                            'Sorry!',
                                            'This Voucher already Posted !!',
                                            'warning'
                                               );
                                    }
                                }
                                ,
                                error: function (jqXHR, textStatus, errorThrown) {
                                    alert(errorThrown);
                                }
                            });
                        }
                    }
                });

            }
            else if (tag == "BD") {
                // $('#Addmodal3').modal('show');
                $("#saveDTB").hide();
                $("#updateDTB").show();
                $.ajax({
                    url: '@Url.Action("GetDepositBYDepositNo", "DepositToBank")',
                    contentType: "application/json;charset=utf-8",
                    data: { depositNo: value },
                    type: 'GET',
                    dataType: 'json',
                    success: function (datas) {
                        if (datas != 0) {
                            $('#Addmodal3').modal('show');
                            $("#DepositNo").val(datas.DepositNo);
                            $("#dVoucherNo").val(datas.VoucherNo);
                            if (DateInDMYformat(datas.DepositDate) != moment('01/01/1900').format('DD/MM/YYYY')) {
                                $("#DepositDate").datepicker("setDate", DateInDMYformat(datas.DepositDate));
                            }
                            //$("#DepositDate").val();
                            $("#DAccode").val(datas.bankAccode).trigger('change.select2');
                            $("#DAmount").val(datas.Amount);
                            $("#DSlipNo").val(datas.DSlipNo);
                        }

                        else {
                            swal(
                                 'Sorry!',
                                 'This Voucher already Posted !!',
                                'warning'
                                 );
                        }

                    }
                });
            }
        });


        $('#Addmodal6').on('shown.bs.modal', function () {
            $(document).off('focusin.modal');
        });

        //Data Table Add script
        function AddOnCashReceiptAndWithdraw(items) {
            var totRcv = 0.0;
            var table = $("#datatable-buttons").DataTable();
            table.clear().draw();
            $.each(items, function (index, data) {
                table.rows.add([[data.SerialNo, data.TransactionNo, data.VoucherNo, data.Purpose, data.Amount, '<a href="#" class="on-default remove-row largeSpace" tag="' + data.Tag + '" deleteSup" data-id="' + data.SerialNo + '" id="delete" value="' + data.TransactionNo + '"><i class="glyphicon glyphicon-trash"></i></a><a href="#" class="on-default remove-row" tag="' + data.Tag + '" deleteSup" data-id="' + data.SerialNo + '" id="edit" value="' + data.TransactionNo + '"><i class="glyphicon glyphicon-edit"></i></a>']]).draw();
                totRcv += data.Amount;

            });
            $("#RecTotal").val(totRcv);
            $("#CloseBal").val(parseFloat($("#OpenBal").val()) + parseFloat($("#RecTotal").val()) - parseFloat($("#PayTotal").val()));
        }
        function AddOnExpenseAndDeposit(items) {
            var totExpense = 0.0;
            var table = $("#datatable-buttons1").DataTable();
            table.clear().draw();
            $.each(items, function (index, data) {
                table.rows.add([[data.SerialNo, data.TransactionNo, data.VoucherNo, data.Purpose, data.Amount, '<a href="#" class="on-default remove-row largeSpace" tag="' + data.Tag + '" deleteSup" data-id="' + data.SerialNo + '" id="delete" value="' + data.TransactionNo + '"><i class="glyphicon glyphicon-trash"></i></a><a href="#" class="on-default remove-row" tag="' + data.Tag + '" deleteSup" data-id="' + data.SerialNo + '" id="edit" value="' + data.TransactionNo + '"><i class="glyphicon glyphicon-edit"></i></a>']]).draw();
                totExpense += data.Amount;
            });
            $("#PayTotal").val(totExpense);
            $("#CloseBal").val(parseFloat($("#OpenBal").val()) + parseFloat($("#RecTotal").val()) - parseFloat($("#PayTotal").val()));

        }

        $('#addSubsidiary').click(function () {
            addSub();
        });

        function addSub() {
            var ammount = parseFloat($("#SubAmount").val()).toFixed(2).replace(".", ","); 
            if ($("#SubsidiaryCode").val() == "0" || $("#SubsidiaryCode option:selected").text() == "--- Select ---") {
                alert("Please select Subsidiary");
                return;
            }
            if (ammount <= 0) {
                alert("Please given Amount ");
                return;
            }
            else {
                addOnSubList();
                $("tbody#tbodyId tr:even").css({
                    "background-color": "#e6e8e8"
                });
            }
            clearSubInfo();
        }
        function clearSubInfo() {
            $('#SubsidiaryCode').val($('#SubsidiaryCode option:first-child').val()).trigger('change.select2');
            $("#SubDescription").val("");
            $("#SubAmount").val("");
        }

        function addOnSubList() {
            var newAddList = [];
            var newAddListSl = 0;

            //var ExpensesubCode = $("#ExpenseNo").val();
            //var Accode = $("#EAccode option:selected").val();
            var SubCode = $("#SubsidiaryCode option:selected").val();
            var Description = $("#SubDescription").val();
            var Amount = parseFloat($("#SubAmount").val()).toFixed(2).replace(".", ","); 
            var SubName = $('#SubsidiaryCode option:selected').text();

            if (Amount != "") {
                var item = {
                    //ExpensesubCode: ExpensesubCode, Accode: Accode,
                    SubCode: SubCode, Description: Description, Amount: Amount, SubName: SubName
                }
                item.Sl = orders.length + 1
                if ("@ViewBag.MrConv" == "C" && subOrders.length == 0) {
                    subOrders.push(item);
                    addOnSubTable();
                } else {
                    swal(
                     'Sorry!',
                     'Already one subsidiary submitted. Please Clear this.!!!',
                     'warning'
                    );
                }
            }
            else {
                swal(
                     'Sorry!',
                     'Something went wrong please try again!',
                     'warning'
                 );

            }
        }

        $(document).on('click', '#deleteTmpSub', function () {
            var id = $(this).attr("value");

            swal({
                title: "Are you sure?",
                text: "You will not be able to recover this order data!",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#DD6B55",
                confirmButtonText: "Yes, delete it!",
                closeOnConfirm: true
            },
             function () {
                 deleteSubRow(id);
                 addOnSubTable();
                 swal("Deleted!", "Your imaginary file has been deleted.", "success");

             });
        });

        function deleteSubRow(sl) {
            var newOrder = [];
            var newSl = 0;

            $.each(subOrders, function (index, data) {

                if (data.Sl != sl) {
                    newSl++;
                    data.Sl = newSl;
                    data.Id = 0;
                    newOrder.push(data);
                }
            });
            subOrders = new Array();
            subOrders = newOrder;

        }

        function addOnSubTable() {

            $('#tbodyId4').empty();
            var sl = 0;
            var amount = 0.0;
            $.each(subOrders, function (index, data) {
                sl = sl + 1;
                data.Sl = sl;
                $("#tbodyId4").append("<tr><td>" + sl + "</td><td>"
                    + data.SubName + "</td><td>"
                    + data.Amount + "</td><td>"
                    + '<a href="#" class="on-default remove-row deleteSup" data-id="' + sl + '" id="deleteTmpSub" value="' + sl + '"><i class="glyphicon glyphicon-trash"></i></a>' + "</td></tr>");
                amount += parseFloat(data.Amount);
            });
            $("#EAmount").val(amount);
            $("#Amount").val(amount);

        }

        $(document).on("click", "#saveSubsidiary", function () {
            @*if ("@ViewBag.MrConv" == "C") {
                    addSub();
                }*@
            $('#Addmodal6').modal('hide');

        });


        function clearSubsidiary() {
            $('#SubsidiaryCode').val($('#SubsidiaryCode option:first-child').val()).trigger('change.select2');
            $("#SubDescription").val("");
            $("#SubAmount").val("");
            subOrders = new Array();
        }


        $(document).on("click", "#closeSubsidiary", function () {
            //$("#purAccode").val($('#purAccode option:first-child').val()).trigger('change.select2');
            $("#EAccode").val($('#EAccode option:first-child').val()).trigger('change.select2');
            $('#Addmodal6').modal('hide');
            clearSubsidiary();
            //table.fnClearTable();
        });

        $(document).on("click", "#clearSubsidiary", function () {
            clearSubsidiary();
        });


        $("#cashClose").on("click", function () {
            var date = moment($('#TrDate').val(), 'DD/MM/YYYY').format('MM/DD/YYYY').toString();
            $("#cashClose").prop("disabled", true);
            $.ajax({
                url: '@Url.Action("CloseCash", "CashOperation")',
                contentType: "application/json;charset=utf-8",
                data: { date: date },
                type: 'GET',
                dataType: 'json',
                success: function (datas) {
                    if (datas == 1) {
                        swal("Sucessfully Cash Closed !", "success");
                        $("#cashClose").prop("disabled", false);
                        clearCashReceipt();
                    }
                    else if (datas == 0) {
                        swal("Last working day cash is not closed. Please close previous date cash first!", "fail");
                        $("#cashClose").prop("disabled", false);
                    }
                    else if (datas == 2) {
                        swal("Cash is Already Closed !", "success");
                        $("#cashClose").prop("disabled", false);
                    }

                }
            });

        });
        $(document).on("click", "#search", function () {
            $("#formSubmit").submit();
            $("#addModalButton").hide();
            $("#    ").hide();
            $("#addModalButton2").hide();
            $("#addModalButton3").hide();
        });

    });
    </script>
}
